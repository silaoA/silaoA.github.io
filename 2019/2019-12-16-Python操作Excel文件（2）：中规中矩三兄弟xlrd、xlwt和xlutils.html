<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录分享Cygwin、Linux、编程等计算机技术"><title>Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils | silaoA的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils</h1><a id="logo" href="/.">silaoA的博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils</h1><div class="post-meta">Dec 16, 2019<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-读文件"><span class="toc-text">0x00 读文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#API"><span class="toc-text">API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例"><span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-数据访问"><span class="toc-text">0x01 数据访问</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#工作簿和表单"><span class="toc-text">工作簿和表单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#行、列、单元格"><span class="toc-text">行、列、单元格</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-改写文件"><span class="toc-text">0x02 改写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#API-1"><span class="toc-text">API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#改写与保存示例"><span class="toc-text">改写与保存示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他辅助"><span class="toc-text">其他辅助</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-总结"><span class="toc-text">0x03 总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#更多阅读"><span class="toc-text">更多阅读</span></a></li></ol></div></div><div class="post-content"><p>本文共3000余字，预计阅读时间14分钟，本文同步发布于知乎（账号silaoA）和微信公众号平台（账号伪码人）。<br>关注学习了解更多的Cygwin、Linux、Python等技术。</p>
<p><code>xlrd</code>、<code>xlwt</code>、<code>xlutils</code>是<a href="www.simplistix.co.uk">Simplistix</a>公司开发，原网站内容基本都清空了，项目迁移到<a href="http://www.python-excel.org/" target="_blank" rel="noopener">http://www.python-excel.org</a>，并在GitHub开源，见<a href="https://github.com/python-excel" target="_blank" rel="noopener">https://github.com/python-excel</a>。三兄弟在操作Excel方面表现中规中矩，能够覆盖大部分需求，也是本人最先熟悉的库。三兄弟一起配合才能比较方便地实现Excel文件的读写，<code>xlutils</code>不是必需，但额外提供了一些简化操作的工具函数。</p>
<a id="more"></a>
<!-- [toc] -->
<h1 id="0x00-读文件"><a href="#0x00-读文件" class="headerlink" title="0x00 读文件"></a>0x00 读文件</h1><p>读文件功能由<code>xlrd</code>包提供。<code>xlrd</code>包实现了<code>xlrd.book.Book</code>（以下简称<code>Book</code>）、<code>xlrd.sheet.Sheet</code>（以下简称<code>Sheet</code>）和<code>xlrd.sheet.Cell</code>（以下简称<code>Cell</code>）类型，与Excel中的工作簿、表单、单元格概念相对应，单元格是最小操作粒度。</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p><code>xlrd</code>没有<code>pyexcel</code>那么花哨，加载表格文件就1个函数——<code>open_workbook</code>，常用参数就2个：</p>
<ol>
<li>filename，指定要打开的Excel文件路径；</li>
<li>on_demand，如果是True则按需加载工作簿中的表单，如果是False则直接加载所有表单，默认为False，为节省资源一般设为True，这在大文件时表现更明显。</li>
</ol>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>假使当前路径下，样例文件名称是<code>data.xls</code>，有3个表单，仅Sheet1有数据，内容如下图，其中C列2行是公式，<code>sum(A2,B2)</code>，C列3行是日期，A列4行是<code>TRUE</code>。<br><img src="https://pic1.zhimg.com/v2-e747c9a3f0c76372b8e78f9bcab285f4_b.png" alt="data.xls Sheet1"></p>
<p>可按下述示例代码加载文件。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlrd <span class="comment"># 导入包</span></span><br><span class="line">In [<span class="number">4</span>]: rbk = xlrd.open_workbook(<span class="string">'./data.xls'</span>,on_demand=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#变量rbk，r代表读，bk代表book</span></span><br><span class="line">In [<span class="number">5</span>]: type(rbk)</span><br><span class="line">Out[<span class="number">5</span>]: xlrd.book.Book</span><br></pre></td></tr></table></figure></p>
<h1 id="0x01-数据访问"><a href="#0x01-数据访问" class="headerlink" title="0x01 数据访问"></a>0x01 数据访问</h1><h2 id="工作簿和表单"><a href="#工作簿和表单" class="headerlink" title="工作簿和表单"></a>工作簿和表单</h2><p>读入Excel文件拿到Workbook后，下一步就是定位到Sheet。<code>Book</code>类对象有几个重要的属性和方法，用于索引Sheet。</p>
<ul>
<li>nsheets属性，指示包含的<code>Sheet</code>对象个数;</li>
<li>sheet_names方法，返回所有表单名称；</li>
<li>sheet_by_index、sheet_by_name方法，分别使用序号、名称索引表单；</li>
<li>sheets方法，返回一个包含所有<code>Sheet</code>对象的列表，。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: rbk.nsheets</span><br><span class="line">Out[<span class="number">7</span>]: <span class="number">3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: rbk.sheet_names()</span><br><span class="line">Out[<span class="number">8</span>]: [<span class="string">'Sheet1'</span>, <span class="string">'Sheet2'</span>, <span class="string">'Sheet3'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: rsh1 = rbk.sheet_by_index(<span class="number">0</span>) <span class="comment"># 通过序号索引</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: rsh2 = rbk.sheet_by_name(<span class="string">'Sheet2'</span>) <span class="comment"># 通过名称索引</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: type(rsh1)</span><br><span class="line">Out[<span class="number">11</span>]: xlrd.sheet.Sheet</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: <span class="keyword">for</span> sh <span class="keyword">in</span> rbk.sheets(): <span class="comment"># 循环遍历每个Sheet</span></span><br><span class="line">    ...:     print(sh.name, sh)</span><br><span class="line">    ...:</span><br><span class="line">Sheet1 &lt;xlrd.sheet.Sheet object at <span class="number">0x00000155511F7F28</span>&gt;</span><br><span class="line">Sheet2 &lt;xlrd.sheet.Sheet object at <span class="number">0x0000015550DF4860</span>&gt;</span><br><span class="line">Sheet3 &lt;xlrd.sheet.Sheet object at <span class="number">0x00000155511E4E80</span>&gt;</span><br></pre></td></tr></table></figure>
<p>拿到<code>Sheet</code>对象后，下一步就是要索引行/列/单元格，获取到行/列/单元格的数据。<code>Sheet</code>类对象有几个重要的属性和方法，用于支持后续操作。</p>
<ul>
<li>name属性，即表单名称；</li>
<li>nrows、ncols属性，指示读入表单的最大行数、列数，由于单元格仅支持行列序号索引，因此这两个属性是检查越界的必备内容；</li>
<li>cell方法，接受2个参数，即行、列序号，返回<code>Cell</code>对象，<strong>注意xlrd仅支持通过行列序号索引单元格，行列序号从0起始</strong>；</li>
<li>cell_value方法，与cell方法类似，只不过返回的是单元格中的值，不是<code>Cell</code>对象；</li>
<li>cell_type方法，返回单元格的类型，见下图；</li>
<li>row、col方法，返回某1整行（列）的<code>Cell</code>对象组成的列表；</li>
<li>row_types、col_types，返回指定行（列）内若干列（行）的单元格的类型；</li>
<li>row_values、col_values，返回指定行（列）内若干列（行）的单元格的值；</li>
<li>row_slice、col_slice，返回指定行（列）内若干列（行）的单元格，是types和values的综合。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">14</span>]: rsh1.nrows, rsh1.ncols <span class="comment"># 查看行列上限</span></span><br><span class="line">Out[<span class="number">14</span>]: (<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: rsh2.nrows, rsh2.ncols <span class="comment"># Sheet2为空</span></span><br><span class="line">Out[<span class="number">15</span>]: (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: cC2 = rsh1.cell(<span class="number">1</span>,<span class="number">2</span>) <span class="comment"># 索引到第2行C列</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: type(cC2)</span><br><span class="line">Out[<span class="number">17</span>]: xlrd.sheet.Cell</span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: rsh1.cell_value(<span class="number">1</span>,<span class="number">2</span>) <span class="comment"># 读公式返回公式值</span></span><br><span class="line">Out[<span class="number">18</span>]: <span class="number">4.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">19</span>]: rsh1.row_values(<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">19</span>]: [<span class="string">'A5'</span>, <span class="string">''</span>, <span class="string">''</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意日期在Excel中只是格式化形式，2019/1/1的值为43466（1900/1/1以来的天数）</span></span><br><span class="line">In [<span class="number">20</span>]: rsh1.col_values(<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">20</span>]: [<span class="string">'列C'</span>, <span class="number">4.0</span>, <span class="number">43466.0</span>, <span class="number">0.0</span>, <span class="string">''</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">21</span>]: rsh1.cell_type(<span class="number">2</span>,<span class="number">2</span>) <span class="comment"># xlrd.XL_CELL_DATE</span></span><br><span class="line">Out[<span class="number">21</span>]: <span class="number">3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: rsh1.cell_type(<span class="number">4</span>,<span class="number">0</span>) <span class="comment"># xlrd.XL_CELL_TEXT</span></span><br><span class="line">Out[<span class="number">22</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: rsh1.cell_type(<span class="number">3</span>,<span class="number">0</span>) <span class="comment"># xlrd.XL_CELL_BOOLEAN</span></span><br><span class="line">Out[<span class="number">23</span>]: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: rsh1.cell_type(<span class="number">3</span>,<span class="number">1</span>) <span class="comment"># xlrd.XL_CELL_NUMBER</span></span><br><span class="line">Out[<span class="number">24</span>]: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: xlrd.XL_CELL_TEXT,xlrd.XL_CELL_NUMBER,xlrd.XL_CELL_DATE</span><br><span class="line">Out[<span class="number">25</span>]: (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: xlrd.XL_CELL_BOOLEAN,xlrd.XL_CELL_ERROR,xlrd.XL_CELL_BLANK,xlrd.XL_CELL_EMPTY</span><br><span class="line">Out[<span class="number">26</span>]: (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">30</span>]: rsh1.col_types(<span class="number">2</span>,<span class="number">1</span>) <span class="comment"># 第2列，第1行起始</span></span><br><span class="line">Out[<span class="number">30</span>]: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">31</span>]: rsh1.row_slice(<span class="number">3</span>,<span class="number">0</span>,<span class="number">3</span>) <span class="comment"># 第3行，第0列起始</span></span><br><span class="line">Out[<span class="number">31</span>]: [bool:<span class="number">1</span>, number:<span class="number">-0.2</span>, number:<span class="number">0.0</span>]</span><br></pre></td></tr></table></figure>
<p><img src="https://pic2.zhimg.com/v2-ebc9df681a738e6769fd5a91f87868e1_b.png" alt="xlrd单元格类型"><br>总结以上，<code>xlrd</code><strong>根据单元格的类型返回恰当的值，Number（整数或小数）类型返回的是浮点数，Text类型返回的是Unicode字符串，Boolean（TRUE或False）类型返回的是1或0，Date类型返回浮点数，公式则求值后根据公式值的类型而定。</strong> </p>
<h2 id="行、列、单元格"><a href="#行、列、单元格" class="headerlink" title="行、列、单元格"></a>行、列、单元格</h2><p>单元格的访问是核心，<code>xlrd</code>包中行、列本质就是<code>Cell</code>对象组成的列表。<code>Cell</code>对象有几个重要属性、方法用于支持获取数据。</p>
<ul>
<li>value属性，和<code>Sheet</code>对象的cell_value方法作用相同；</li>
<li>ctype属性，和<code>Sheet</code>对象的cell_type方法作用相同；</li>
<li>dump方法，打印单元格信息。</li>
</ul>
<p>为便于索引，<code>xlrd</code>包的cellname、cellnameabs、colname函数，将行列序号转换为Excel风格的单元格地址；<code>xlwt.Utils</code>模块的rowcol_to_cell、rowcol_pair_to_cellrange函数，也可以将行列序号转换为Excel风格的单元格地址；而col_by_name、cell_to_rowcol、cell_to_rowcol2、cellrange_to_rowcol_pair函数，则将Excel风格的单元格地址转换为行列序号。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">35</span>]: xlrd.cellname(<span class="number">2</span>,<span class="number">10</span>)</span><br><span class="line">Out[<span class="number">35</span>]: <span class="string">'K3'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">36</span>]: xlrd.cellnameabs(<span class="number">2</span>,<span class="number">10</span>) <span class="comment"># 结果为绝对引用地址</span></span><br><span class="line">Out[<span class="number">36</span>]: <span class="string">'$K$3'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意列名称必须大写，小写是错误的！</span></span><br><span class="line">In [<span class="number">44</span>]: xlwt.Utils.col_by_name(<span class="string">'K'</span>),xlwt.Utils.col_by_name(<span class="string">'k'</span>)</span><br><span class="line">Out[<span class="number">44</span>]: (<span class="number">10</span>, <span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">45</span>]: rsh1.col_values(xlwt.Utils.col_by_name(<span class="string">'C'</span>))</span><br><span class="line">Out[<span class="number">45</span>]: [<span class="string">'列C'</span>, <span class="number">4.0</span>, <span class="number">43466.0</span>, <span class="number">0.0</span>, <span class="string">''</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">46</span>]: xlwt.Utils.cell_to_rowcol(<span class="string">'K3'</span>) <span class="comment"># 行列均无绝对引用</span></span><br><span class="line">Out[<span class="number">46</span>]: (<span class="number">2</span>, <span class="number">10</span>, <span class="literal">False</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">47</span>]: xlwt.Utils.cell_to_rowcol(<span class="string">'K$3'</span>) <span class="comment"># 行绝对引用</span></span><br><span class="line">Out[<span class="number">47</span>]: (<span class="number">2</span>, <span class="number">10</span>, <span class="literal">True</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 与上一个函数的区别是忽略绝对引用符号</span></span><br><span class="line">In [<span class="number">48</span>]: xlwt.Utils.cell_to_rowcol2(<span class="string">'K$3'</span>)</span><br><span class="line">Out[<span class="number">48</span>]: (<span class="number">2</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># cC2是C2单元格，在前一小节In [16]创建</span></span><br><span class="line">In [<span class="number">50</span>]: cC2.ctype, cC2.value</span><br><span class="line">Out[<span class="number">50</span>]: (<span class="number">2</span>, <span class="number">4.0</span>)</span><br></pre></td></tr></table></figure>
<p>行列序号与单元格地址转换总结如下图。<br><img src="https://pic3.zhimg.com/v2-b8736c01199e63b3a3bbb0b70d3edf62_b.png" alt="行列序号与单元格地址转换"></p>
<p>要遍历1个sheet内所有单元格，通常按行、列顺序逐个得到单元格，再读出单元格值存起来，以便后续处理。也可以直接得到一整行（列），整行（列）地处理数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、逐单元格处理</span></span><br><span class="line"><span class="keyword">for</span> rx <span class="keyword">in</span> range(rsh.nrows):</span><br><span class="line">	<span class="keyword">for</span> cx <span class="keyword">in</span> range(rsh.ncols):</span><br><span class="line">		c = rsh.cell(rx, cx)</span><br><span class="line">		<span class="comment"># 对单元格的进一步处理</span></span><br><span class="line">		print(c.ctype, c.value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、整行处理</span></span><br><span class="line"><span class="keyword">for</span> rx <span class="keyword">in</span> range(rsh.nrows):</span><br><span class="line">	row = rsh.row(rx)</span><br><span class="line">	<span class="comment"># 对行的进一步处理</span></span><br><span class="line">	print(len(row))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、整列处理</span></span><br><span class="line"><span class="keyword">for</span> cx <span class="keyword">in</span> range(rsh.ncols):</span><br><span class="line">	col = rsh.col(cx)</span><br><span class="line">	<span class="comment"># 对列的进一步处理</span></span><br><span class="line">	print(len(col))</span><br></pre></td></tr></table></figure></p>
<h1 id="0x02-改写文件"><a href="#0x02-改写文件" class="headerlink" title="0x02 改写文件"></a>0x02 改写文件</h1><p><code>xlrd</code>包只能将表单内的数据读出来，对改写数据无能为力，改写数据和保存至文件，由<code>xlwt</code>包完成。<code>xlwt</code>实现了一套<code>xlwt.Workbook.Workbook</code>（以下简称<code>Workbook</code>）、<code>xlwt.Worksheet.Worksheet</code>（以下简称<code>Worksheet</code>）类型，但很不幸与<code>xlrd</code>包的不存在继承关系，这导致<strong>用<code>xlrd</code>包读出来的<code>Book</code>、<code>Sheet</code>对象并不能直接用于创建<code>Workbook</code>和<code>Worksheet</code>对象，只能把数据暂存着以备后续再写回去，使得过程十分繁琐</strong>。</p>
<h2 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h2><p><code>xlwt</code>包对外暴露的类型、方法、函数及参数也十分简洁，紧密契合改写数据、保存至文件的流程，属于“人狠话不多”的类型。</p>
<ol>
<li>调用<code>Workbook</code>模块的Workbook函数，创建<code>Workbook</code>对象，第1个参数是encoding，直接默认’ascii’即可；</li>
<li>调用<code>Workbook</code>对象的add_sheet方法，往<code>Workbook</code>中添加<code>Worksheet</code>对象，第1个参数sheetname指定表单名称，第2个参数cell_overwrite_ok确定是否允许单元格覆写，建议设置为True，避免对程序可能对单元格多次写数据而抛出错误；</li>
<li>调用<code>Worksheet</code>对象的write方法，往<code>Worksheet</code>的行/列/单元格内写入数据，此处用到的数据多数情况来自<code>xlrd</code>包从Excel文件读出来的结果，前2个参数为行列序号，第3个参数是要写入的值，第4个参数是单元格风格，如无特殊需求默认即可；</li>
<li>调用<code>Workbook</code>对象的save方法，将<code>Workbook</code>对象保存至文件，参数为文件名称或文件流对象。</li>
</ol>
<p>其他的属性、方法、函数一般用的较少。</p>
<h2 id="改写与保存示例"><a href="#改写与保存示例" class="headerlink" title="改写与保存示例"></a>改写与保存示例</h2><p>假使将前一节<code>data.xls</code>中读出的表格做简单处理，再保存至新的Excel文件。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlwt  <span class="comment"># 导入库</span></span><br><span class="line">In [<span class="number">51</span>]: wbk = xlwt.Workbook()</span><br><span class="line"></span><br><span class="line">In [<span class="number">52</span>]: type(wbk)</span><br><span class="line">Out[<span class="number">52</span>]: xlwt.Workbook.Workbook</span><br><span class="line"></span><br><span class="line">In [<span class="number">53</span>]: wsh1 = wbk.add_sheet(<span class="string">"Sheet1"</span>, cell_overwrite_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">54</span>]: type(wsh1)</span><br><span class="line">Out[<span class="number">54</span>]: xlwt.Worksheet.Worksheet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将rsh1中的数据复制到wsh1，刻意多空1行、1列</span></span><br><span class="line">In [<span class="number">55</span>]: <span class="keyword">for</span> rx <span class="keyword">in</span> range(rsh1.nrows):</span><br><span class="line">    ...:     <span class="keyword">for</span> cx <span class="keyword">in</span> range(rsh1.ncols):</span><br><span class="line">    ...:         wsh1.write(rx+<span class="number">1</span>,cx+<span class="number">1</span>,rsh1.cell_value(rx,cx))</span><br><span class="line"></span><br><span class="line">In [<span class="number">56</span>]: wsh1.write(<span class="number">0</span>,<span class="number">0</span>, <span class="string">'新数据A1'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">59</span>]: wsh1.write(<span class="number">0</span>,<span class="number">1</span>, <span class="number">3.14159</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">60</span>]: wsh1.write(<span class="number">0</span>,<span class="number">6</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">61</span>]: wsh1.write(<span class="number">4</span>+<span class="number">1</span>,<span class="number">0</span>+<span class="number">1</span>,<span class="literal">False</span>) <span class="comment"># 覆写原表第4行A列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 覆写原表第4行D列</span></span><br><span class="line">In [<span class="number">62</span>]: wsh1.write(<span class="number">3</span>+<span class="number">1</span>, xlwt.Utils.col_by_name(<span class="string">'D'</span>),<span class="string">'列D'</span>)</span><br></pre></td></tr></table></figure></p>
<p>经过一番改写，目前所有的改动仍在内存中，调用<code>Workbook</code>对象的save方法，可将数据写入文件中。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">65</span>]: wbk.save(<span class="string">'./data2.xls'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">66</span>]: wbk.save(<span class="string">'./data-second.xlsx'</span>) <span class="comment"># 可以多次保存</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">67</span>]: wbk.save(<span class="string">'./data-second.xlsx'</span>) <span class="comment"># 本质还是xls格式</span></span><br></pre></td></tr></table></figure></p>
<p>对于保存，有两点需要提醒：</p>
<ol>
<li><strong>Python所有涉及Excel操作的库都不支持“原地编辑与保存”，<code>xlwt</code>也不例外，“保存”实际上是“另存为”，只是指定保存到原文件的话，原文件被覆盖。</strong></li>
<li><strong><code>xlwt</code>支持写入到xls格式文件，不支持xlsx格式，即使指定扩展名.xlsx，文件格式本身仍是xls格式。</strong></li>
</ol>
<p>保存后文件内容如下图。<br><img src="https://pic4.zhimg.com/v2-bcc80dc5b7bb464b21f4dabeb68fc1df_b.png" alt="datasecond.xls Sheet1"></p>
<p>注意从<code>data.xls</code>中读出来的日期，本质是数值，复制后写入还是数值，需要在Excel中将单元格设定为日期格式，才能显示为日期形式。上述写入过程忽略了单元格风格，原<code>data.xls</code>中包含的风格信息被全部丢失。关于单元格风格支持，详见<code>xlwt.Style</code>模块API，风格设置过程繁琐，不如在Excel软件中操作方便，本文不做评述。</p>
<p><code>xlwt</code>还支持写入公式，但较为有限，比如支持<code>countif</code>却不支持<code>countifs</code>，写入不支持的公式会报错。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第3行E列写入公式</span></span><br><span class="line">In [<span class="number">69</span>]: wsh1.write(<span class="number">2</span>,<span class="number">4</span>, xlwt.Formula(<span class="string">'sum(A3:D3)'</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">70</span>]: wbk.save(<span class="string">'./data-含公式.xls'</span>)</span><br></pre></td></tr></table></figure></p>
<p>表格保存后文件内容如下。<br><img src="https://pic1.zhimg.com/v2-a02fcba043685fc4c8f5f6c4dbacf7cc_b.png" alt="data-含公式.xls Sheet1"></p>
<h2 id="其他辅助"><a href="#其他辅助" class="headerlink" title="其他辅助"></a>其他辅助</h2><p>从上述步骤看，如果仅是生成全新的Excel文件，使用<code>xlwt</code>包即可。如果是“编辑”Excel文件中的某些数据，则必须使用<code>xlrd</code>加载原文件并将原表格复制一份，再使用<code>xlwt</code>去处理需要编辑的单元格，流程繁琐。<code>xlutils</code>包的<code>copy</code>正是为简化此流程而生，可以将<code>xlrd</code>的<code>Book</code>对象复制转换为<code>xlwt</code>的<code>Workbook</code>对象。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlutils.copy <span class="comment"># 导入模块</span></span><br><span class="line"><span class="comment"># rbk是xlrd载入data.xls文件对应的工作簿，见In [4]</span></span><br><span class="line">In [<span class="number">78</span>]: wbk2 = xlutils.copy.copy(rbk)</span><br><span class="line"></span><br><span class="line">In [<span class="number">79</span>]: wbk2</span><br><span class="line">Out[<span class="number">79</span>]: &lt;xlwt.Workbook.Workbook at <span class="number">0x15552d5aba8</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">84</span>]: sh = wbk2.get_sheet(<span class="number">0</span>) <span class="comment"># 索引到Sheet1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">85</span>]: sh.write(<span class="number">0</span>,<span class="number">6</span>,<span class="string">'COPIED'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">86</span>]: wbk2.add_sheet(<span class="string">'表单2'</span>) <span class="comment">#新增表单</span></span><br><span class="line">Out[<span class="number">86</span>]: &lt;xlwt.Worksheet.Worksheet at <span class="number">0x15552cda048</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">87</span>]: wbk2.save(<span class="string">'./data-copy.xls'</span>)</span><br></pre></td></tr></table></figure></p>
<p><code>xlutils.copy.copy</code>是以工作簿整体复制和转换，原<code>data.xls</code>文件的3个表单均被复制过来，上述代码对Sheet1做了修改，后又增加了新表单，保存后文件内容如下。<br><img src="https://pic2.zhimg.com/v2-2ed0e9de09e6a84dbb8767efc4d0aea9_b.png" alt="data-copy.xls"></p>
<p>除了<code>copy</code>模块，<code>xlutils</code>包中还有<code>display</code>、<code>filter</code>等模块辅助操作Excel文件。</p>
<h1 id="0x03-总结"><a href="#0x03-总结" class="headerlink" title="0x03 总结"></a>0x03 总结</h1><p>从上述读写的示例来看，<code>xlrd</code>负责读、<code>xlwt</code>负责写、<code>xlutils</code>负责提供辅助和衔接，三兄弟各自相对独立而分工明确、配合紧密。<code>xlrd</code>、<code>xlwt</code>、<code>xlutils</code>是以十分原始的方式进行数据访问，流程相对繁琐，好在功能支持方面可以满足大部分需求。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li>Working with Excel files in Python，2009. <a href="www.python-excel.org">www.python-excel.org</a></li>
</ul>
<h1 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h1><ul>
<li><a href="/2019/2019-12-10-Python操作Excel文件（1）：花式大师pyexcel.html">Python操作Excel文件（1）：花式大师pyexcel</a></li>
<li><a href="/2019/2019-12-03-Python操作Excel文件（0）：盘点.html">Python操作Excel文件（0）：盘点</a></li>
<li><a href="/2019/2019-08-15-Python项目如何合理组织规避import天坑.html">Python项目如何合理组织规避import天坑</a></li>
<li><a href="/2019/2019-02-05-Cygwin前传：从割据到互补.html">Cygwin前传：从割据到互补</a></li>
<li><a href="/2019/2019-02-14-Cygwin系列（一）：Cygwin是什么.html">Cygwin系列（一）：Cygwin是什么</a></li>
<li><a href="/2019/2019-06-16-Cygwin系列（九）：Cygwin学习路线.html">Cygwin系列（九）：Cygwin学习路线</a></li>
<li><a href="/2019/2019-04-04-Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念.html">Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念</a> </li>
<li><a href="/2019/2019-05-04-Linux Cygwin知识库（二）：目录、文件及基本操作.html">Linux Cygwin知识库（二）：目录、文件及基本操作</a></li>
<li><a href="https://zhuanlan.zhihu.com/c_1078678205585551360" target="_blank" rel="noopener">专栏：伪码人We_Coder</a></li>
</ul>
<hr>
<p><strong>如本文对你有帮助，或内容引起极度舒适，欢迎分享转发或点击下方捐赠按钮打赏</strong> ^_^</p>
</div><iframe src="/donate/?AliPayQR=/pic/AliPayQR.jpg&amp;WeChatQR=/pic/WeChatQR.png&amp;GitHub=https://github.com/Kaiyuan/donate-page&amp;BTCQR=undefined&amp;BTCKEY=undefined&amp;PayPal=undefined" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>silaoA</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2019/2019-12-16-Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils.html">https://silaoa.github.io/2019/2019-12-16-Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils.html</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为原创文章，如需转载，请联系stsilaoa@gmail.com 或 公众号 伪码人 或知乎私信 silaoA。</li></ul></div><br><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a class="pre" href="/2019/2019-12-20-Python操作Excel文件（3）：优雅干将openpyxl.html">Python操作Excel文件（3）：优雅干将openpyxl</a><a class="next" href="/2019/2019-12-10-Python操作Excel文件（1）：花式大师pyexcel.html">Python操作Excel文件（1）：花式大师pyexcel</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://silaoa.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">25</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/Cygwin/" style="font-size: 15px;">Cygwin</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/IEEE/" style="font-size: 15px;">IEEE</a> <a href="/tags/机器人/" style="font-size: 15px;">机器人</a> <a href="/tags/科技/" style="font-size: 15px;">科技</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/WSL/" style="font-size: 15px;">WSL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/2020-01-13-Cygwin系列（十一）：折腾终端2.html">Cygwin系列（十一）：折腾终端2</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-29-Cygwin系列（十）：折腾终端1.html">Cygwin系列（十）：折腾终端1</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-20-Python操作Excel文件（3）：优雅干将openpyxl.html">Python操作Excel文件（3）：优雅干将openpyxl</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-16-Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils.html">Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-10-Python操作Excel文件（1）：花式大师pyexcel.html">Python操作Excel文件（1）：花式大师pyexcel</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-03-Python操作Excel文件（0）：盘点.html">Python操作Excel文件（0）：盘点</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-08-28-安装Windows7排除USB3驱动缺失问题的经历.html">安装Windows7排除USB3驱动缺失问题的经历</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-08-15-Python项目如何合理组织规避import天坑.html">Python项目如何合理组织规避import天坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-06-16-Cygwin系列（九）：Cygwin学习路线.html">Cygwin系列（九）：Cygwin学习路线</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-05-25-Cygwin系列（八）：命令行软件包管理器apt-cyg.html">Cygwin系列（八）：命令行软件包管理器apt-cyg</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://silaoa.github.io" title="silaoA的网络日志" target="_blank">silaoA的网络日志</a><ul></ul><a href="http://www.zhihu.com/people/laoa-si/posts" title="silaoA的知乎文章" target="_blank">silaoA的知乎文章</a><ul></ul><a title="微信公众号：伪码人（We_Coder）" target="_blank">微信公众号：伪码人（We_Coder）</a><ul></ul><a title="QQ交流群：374791536" target="_blank">QQ交流群：374791536</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">silaoA的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>