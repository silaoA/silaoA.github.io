<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录分享Cygwin、Linux、编程等计算机技术"><title>Python操作Excel文件（3）：优雅干将openpyxl | silaoA的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Python操作Excel文件（3）：优雅干将openpyxl</h1><a id="logo" href="/.">silaoA的博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Python操作Excel文件（3）：优雅干将openpyxl</h1><div class="post-meta">Dec 20, 2019<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-读文件"><span class="toc-text">0x00 读文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#API"><span class="toc-text">API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例"><span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-数据访问"><span class="toc-text">0x01 数据访问</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#索引表单"><span class="toc-text">索引表单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引单元格"><span class="toc-text">索引单元格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#读取单元格的值"><span class="toc-text">读取单元格的值</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-改写文件"><span class="toc-text">0x02 改写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#流程概述"><span class="toc-text">流程概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建工作簿"><span class="toc-text">创建工作簿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建、删除表单"><span class="toc-text">创建、删除表单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编辑数据"><span class="toc-text">编辑数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他高阶编辑"><span class="toc-text">其他高阶编辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#保存"><span class="toc-text">保存</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-总结"><span class="toc-text">0x03 总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#更多阅读"><span class="toc-text">更多阅读</span></a></li></ol></div></div><div class="post-content"><p>本文共4000余字，预计阅读时间16分钟，本文同步发布于知乎专栏和微信公众号平台。<br>关注学习了解更多的Cygwin、Linux、Python技术。</p>
<p><code>openpyxl</code>诞生于Python生态中缺乏原生读写<a href="http://www.officeopenxml.com/" target="_blank" rel="noopener">Office Open XML</a>格式文件（也就是xlsx格式）的背景下，由一群志愿者在业余时间开发维护，项目地址 <a href="http://bitbucket.org/openpyxl/openpyxl" target="_blank" rel="noopener">http://bitbucket.org/openpyxl/openpyxl</a>。相较<code>pyexcel</code>、<code>xlrd/xlwt/xlutils</code>，<code>openpyxl</code>对Excel的功能支持更加丰富，同时在实现上又十分优雅，操作逻辑与直接用Excel软件接近，运行效率也很高，堪称Excel文件操作的优雅干将。<br>本文所用<code>openpyxl</code>版本为3.0，旧版本可能部分API有所不同。</p>
<a id="more"></a>
<h1 id="0x00-读文件"><a href="#0x00-读文件" class="headerlink" title="0x00 读文件"></a>0x00 读文件</h1><p><code>openpyxl</code>设计比<code>pyexcel</code>、<code>xlrd/xlwt/xlutils</code>，<code>openpyxl</code>更复杂一点，包下有<code>workbook</code>、<code>worksheet</code>、<code>cell</code>、<code>formattint</code>、<code>chart</code>、<code>formula</code>等子包，功能划分清晰，实现了<code>openpyxl.workbook.workbook.Workbook</code>（以下简称<code>Workbook</code>）、<code>openpyxl.worksheet.worksheet.Worksheet</code>（以下简称<code>Worksheet</code>）和<code>openpyxl.cell.cell.Cell</code>（以下简称<code>Cell</code>）类型，与Excel中的工作簿、表单、单元格概念相对应。读写Excel文件，就是围绕这3种对象开展。</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p><code>openpyxl</code>对外的API十分简练，加载已有表格文件就1个函数——<code>load_workbook</code>，返回<code>Workbook</code>对象，总共接收5个参数：</p>
<ol>
<li>filename，必选参数，指定要打开的Excel文件路径；</li>
<li>read_only，默认参数，指定是否只读，默认False，如果不需要编辑内容可设为<code>True</code>；</li>
<li>keep_vba，默认参数，指定是否保留VBA内容，但即使保留也不能使用，默认False；</li>
<li>data_only，默认参数，指定含公式的单元格保留公式内容还是公式值，默认False；</li>
<li>keep_links，默认参数，指定单元格中的外部链接是否保存，默认True。</li>
</ol>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>假使当前路径下，样例文件名称是<code>data.xlsx</code>，有3个表单，仅Sheet1有数据，内容如下图，其中C列2行是公式，<code>sum(A2,B2)</code>，C列3行是日期，A列4行是<code>TRUE</code>。<br><img src="https://pic3.zhimg.com/v2-4678eac6fca7adc6639f7b39c058eaa2_b.png" alt="data.xlsx Sheet1"></p>
<p>可按下述示例代码加载文件。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openpyxl <span class="comment"># 导入包</span></span><br><span class="line">In [<span class="number">5</span>]: bk = openpyxl.load_workbook(<span class="string">'./data.xlsx'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: type(bk)</span><br><span class="line">Out[<span class="number">6</span>]: openpyxl.workbook.workbook.Workbook</span><br><span class="line"></span><br><span class="line">In [7]: bk?</span><br><span class="line">Type:        Workbook</span><br><span class="line">String form: &lt;openpyxl.workbook.workbook.Workbook object at <span class="number">0x000001F51B0F7128</span>&gt;</span><br><span class="line">File:        d:\program files\python36\lib\site-packages\openpyxl\workbook\workbook.py</span><br><span class="line">Docstring:   Workbook <span class="keyword">is</span> the container <span class="keyword">for</span> all other parts of the document.</span><br></pre></td></tr></table></figure></p>
<h1 id="0x01-数据访问"><a href="#0x01-数据访问" class="headerlink" title="0x01 数据访问"></a>0x01 数据访问</h1><h2 id="索引表单"><a href="#索引表单" class="headerlink" title="索引表单"></a>索引表单</h2><p>读入Excel文件拿到Workbook后，下一步就是定位到Worksheet。<code>Workbook</code>类对象有几个重要的属性和方法，用于索引Sheet。</p>
<ul>
<li>active属性，指代工作簿中的激活表单，也就是保存前最后操作的表单;</li>
<li>get_active_sheet方法，作用与active属性相同，已废弃，<strong>建议直接用active属性</strong>；</li>
<li>sheetnames属性，即工作簿中所有表单的名称所组成的列表；</li>
<li>get_sheet_names方法，作用与sheetnames属性相同，已废弃，<strong>建议直接用sheetnames属性</strong>；</li>
<li>get_sheet_by_name方法，使用名称索引表单，已废弃，<strong>建议直接用名称作关键字，按字典的方式索引</strong>，可以说相当优雅了；</li>
<li>index、get_index方法，均用于指示<code>Worksheet</code>对象的序号，后者已废弃，<strong>建议用index方法</strong>。</li>
</ul>
<p><code>Workbook</code>类对象还支持直接for循环迭代，遍历<code>Worksheet</code>对象。</p>
<p>比较诡异的是，<code>Workbook</code>类对象给表单分配了序号，却<strong>不支持通过序号索引表单，也<em>没有</em> get_sheet_by_index 方法</strong>，官方认为用名称作关键字、按字典的方式索引更自然。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">8</span>]: bk.active <span class="comment"># 建议使用</span></span><br><span class="line">Out[<span class="number">8</span>]: &lt;Worksheet <span class="string">"Sheet1"</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: bk.get_active_sheet()</span><br><span class="line">D:\Program Files\Python36\Scripts\ipython3:<span class="number">1</span>: DeprecationWarning: Call to deprecated function get_active_sheet (Use the .active property).</span><br><span class="line">Out[<span class="number">9</span>]: &lt;Worksheet <span class="string">"Sheet1"</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: bk.sheetnames <span class="comment"># 建议使用</span></span><br><span class="line">Out[<span class="number">10</span>]: [<span class="string">'Sheet1'</span>, <span class="string">'Sheet2'</span>, <span class="string">'Sheet3'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: bk.get_sheet_names()</span><br><span class="line">D:\Program Files\Python36\Scripts\ipython3:<span class="number">1</span>: DeprecationWarning: Call to deprecated function get_sheet_names (Use wb.sheetnames).</span><br><span class="line">Out[<span class="number">11</span>]: [<span class="string">'Sheet1'</span>, <span class="string">'Sheet2'</span>, <span class="string">'Sheet3'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: sh1 = bk.get_sheet_names(<span class="string">'Sheet1'</span>)</span><br><span class="line">D:\Program Files\Python36\Scripts\ipython3:<span class="number">1</span>: DeprecationWarning: Call to deprecated function get_sheet_names (Use wb.sheetnames).</span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: sh1 = bk.get_sheet_by_name(<span class="string">'Sheet1'</span>)</span><br><span class="line">D:\Program Files\Python36\Scripts\ipython3:<span class="number">1</span>: DeprecationWarning: Call to deprecated function get_sheet_by_name (Use wb[sheetname]).</span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: sh2 = bk[<span class="string">'Sheet2'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: sh4 = bk[<span class="string">'Sheet4'</span>] <span class="comment"># 不存在的名字作关键字，报错</span></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">KeyError            Traceback (most recent call last)</span><br><span class="line">KeyError: <span class="string">'Worksheet Sheet4 does not exist.'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: bk.index(sh1) <span class="comment"># 建议使用</span></span><br><span class="line">Out[<span class="number">18</span>]: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">19</span>]: bk.get_index(sh2)</span><br><span class="line">D:\Program Files\Python36\Scripts\ipython3:<span class="number">1</span>: DeprecationWarning: Call to deprecated function get_index (Use wb.index(worksheet)).</span><br><span class="line">Out[<span class="number">19</span>]: <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="索引单元格"><a href="#索引单元格" class="headerlink" title="索引单元格"></a>索引单元格</h2><p>拿到<code>Worksheet</code>对象后，下一步就是要索引行/列/单元格，并读取数据，<code>openpyxl</code>中行/列只不过是<code>Cell</code>对象组成的元组。<code>Worksheet</code>类对象有几个重要的属性和方法，用于支持后续操作。</p>
<ul>
<li>title属性，指示表单名称；</li>
<li>dimensions属性，指示表单中单元格的范围，风格与Excel一致；</li>
<li>calculate_dimension方法，作用与dimensions属性相同；</li>
<li>min_row、max_row、min_column、max_column属性，指示表单当前最小、最大的行序号和列序号，<strong>注意行列序号从1起始</strong>，可以说非常人性化了；</li>
<li>cell方法，一共接受3个参数，前2个是必选参数，指定行、列序号，第3个是可选参数，指定单元格的值，由此索引或创建1个<code>Cell</code>对象；</li>
<li>rows、columns属性，按行（列）顺序组织的<code>Cell</code>对象生成器；</li>
<li>iter_rows、iter_cols，接受5个参数，前4个参数指定最小、最大行（列）序号和列（行）序号，划出单元格范围，第5个参数values_only指示是否仅返回值，默认False，返回按行（列）排序的单元格生成器；</li>
</ul>
<p>除了上述cell、iter_rows、iter_cols方法，<code>Worksheet</code>对象支持通过<strong>切片方式索引</strong>单元格，返回嵌套元组，既接受行（列）序号的形式，也接受Excel风格地址的形式，而且<strong>不必区分大小写</strong>（说的就是<code>xlrd</code>/<code>xlwt</code>，必须大写，小写错误）。无论切片方式索引或调用iter_rows、iter_cols方法，返回的是可迭代对象，可以直接用在for循环迭代中，可谓相当优雅。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">23</span>]: sh1.dimensions</span><br><span class="line">Out[<span class="number">23</span>]: <span class="string">'A1:C5'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: sh1.max_row,sh1.max_column</span><br><span class="line">Out[<span class="number">24</span>]: (<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: sh1.min_row,sh1.min_column</span><br><span class="line">Out[<span class="number">25</span>]: (<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">27</span>]: sh1.title</span><br><span class="line">Out[<span class="number">27</span>]: <span class="string">'Sheet1'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">32</span>]: sh1.cell(<span class="number">3</span>,<span class="number">2</span>)  <span class="comment"># 第3行B列</span></span><br><span class="line">Out[<span class="number">32</span>]: &lt;Cell <span class="string">'Sheet1'</span>.B3&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">33</span>]: sh1[<span class="string">'B3'</span>]  <span class="comment"># 第3行B列</span></span><br><span class="line">Out[<span class="number">33</span>]: &lt;Cell <span class="string">'Sheet1'</span>.B3&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># A2至B3，按行排序，结果可直接用在for循环中，如 for row in sh1['A2':'B3']</span></span><br><span class="line">In [<span class="number">34</span>]: sh1[<span class="string">'A2'</span>:<span class="string">'B3'</span>] </span><br><span class="line">Out[<span class="number">34</span>]:</span><br><span class="line">((&lt;Cell <span class="string">'Sheet1'</span>.A2&gt;, &lt;Cell <span class="string">'Sheet1'</span>.B2&gt;),</span><br><span class="line"> (&lt;Cell <span class="string">'Sheet1'</span>.A3&gt;, &lt;Cell <span class="string">'Sheet1'</span>.B3&gt;))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第2至4行，注意4也包括在内，结果可直接用在for循环中，如 for row in sh1[2:4]</span></span><br><span class="line">In [<span class="number">35</span>]: sh1[<span class="number">2</span>:<span class="number">4</span>] </span><br><span class="line">Out[<span class="number">35</span>]:</span><br><span class="line">((&lt;Cell <span class="string">'Sheet1'</span>.A2&gt;, &lt;Cell <span class="string">'Sheet1'</span>.B2&gt;, &lt;Cell <span class="string">'Sheet1'</span>.C2&gt;),</span><br><span class="line"> (&lt;Cell <span class="string">'Sheet1'</span>.A3&gt;, &lt;Cell <span class="string">'Sheet1'</span>.B3&gt;, &lt;Cell <span class="string">'Sheet1'</span>.C3&gt;),</span><br><span class="line"> (&lt;Cell <span class="string">'Sheet1'</span>.A4&gt;, &lt;Cell <span class="string">'Sheet1'</span>.B4&gt;, &lt;Cell <span class="string">'Sheet1'</span>.C4&gt;))</span><br><span class="line"></span><br><span class="line"><span class="comment"># A2至B3，按行排序，结果可直接用在for循环中，如 for row in sh1.iter_rows(2,3,1,2)</span></span><br><span class="line">In [<span class="number">37</span>]: tuple(sh1.iter_rows(<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>)) </span><br><span class="line">Out[<span class="number">37</span>]:</span><br><span class="line">((&lt;Cell <span class="string">'Sheet1'</span>.A2&gt;, &lt;Cell <span class="string">'Sheet1'</span>.B2&gt;),</span><br><span class="line"> (&lt;Cell <span class="string">'Sheet1'</span>.A3&gt;, &lt;Cell <span class="string">'Sheet1'</span>.B3&gt;))</span><br><span class="line"></span><br><span class="line"><span class="comment"># A2至B3，按列排序，结果可直接用在for循环中，如 for col in sh1.iter_cols(1,2,2,3)</span></span><br><span class="line">In [<span class="number">39</span>]: tuple(sh1.iter_cols(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)) </span><br><span class="line">Out[<span class="number">39</span>]:</span><br><span class="line">((&lt;Cell <span class="string">'Sheet1'</span>.A2&gt;, &lt;Cell <span class="string">'Sheet1'</span>.A3&gt;),</span><br><span class="line"> (&lt;Cell <span class="string">'Sheet1'</span>.B2&gt;, &lt;Cell <span class="string">'Sheet1'</span>.B3&gt;))</span><br><span class="line"></span><br><span class="line">In [<span class="number">40</span>]: sh1.iter_cols(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)  <span class="comment"># A2至B3，返回生成器</span></span><br><span class="line">Out[<span class="number">40</span>]: &lt;generator object Worksheet._cells_by_col at <span class="number">0x000001F51BB0D830</span>&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="读取单元格的值"><a href="#读取单元格的值" class="headerlink" title="读取单元格的值"></a>读取单元格的值</h2><p><code>Cell</code>类对象有个value属性，指示单元格的值，除此外还有类型、显示、风格等属性值得关注。</p>
<ul>
<li>row、column属性，指示单元格的行列序号；</li>
<li>column_letter属性，指示单元格列名称；</li>
<li>coordinate属性，指示单元格Excel风格的地址名称；</li>
<li>data_type属性，指示单元格value的类型，<code>openpyxl</code>中分类如下图；</li>
<li>internal_value属性，值在<code>openpyxl</code>内部表示；</li>
<li>hyperlink属性，单元格指向的外部链接；</li>
<li>is_date属性，指示是否为日期。</li>
</ul>
<p><img src="https://pic2.zhimg.com/v2-dacd0a88756c2bcfebc492b5a7c33535_b.png" alt="openpyxl单元格值类型"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">44</span>]: cC3 = sh1[<span class="string">'C3'</span>] <span class="comment"># C3单元格</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">45</span>]: cA4 = sh1[<span class="string">'A4'</span>] <span class="comment"># A4单元格</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">46</span>]: cC3.row,cC3.column</span><br><span class="line">Out[<span class="number">46</span>]: (<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">47</span>]: cA4.row, cA4.column</span><br><span class="line">Out[<span class="number">47</span>]: (<span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">48</span>]: cA4.column_letter, cA4.coordinate</span><br><span class="line">Out[<span class="number">48</span>]: (<span class="string">'A'</span>, <span class="string">'A4'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">50</span>]: cA4.data_type, cC3.data_type</span><br><span class="line">Out[<span class="number">50</span>]: (<span class="string">'b'</span>, <span class="string">'d'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意含公式的单元格，返回是公式字符串，不是求值</span></span><br><span class="line">In [<span class="number">53</span>]: sh1[<span class="string">'c2'</span>].value <span class="comment"># 单元格地址小写也不影响</span></span><br><span class="line">Out[<span class="number">53</span>]: <span class="string">'=SUM(A2,B2)'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">54</span>]: sh1[<span class="string">'B2'</span>].value</span><br><span class="line">Out[<span class="number">54</span>]: <span class="number">3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">56</span>]: sh1[<span class="string">'c2'</span>].internal_value</span><br><span class="line">Out[<span class="number">56</span>]: <span class="string">'=SUM(A2,B2)'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">57</span>]: cC3.internal_value</span><br><span class="line">Out[<span class="number">57</span>]: datetime.datetime(<span class="number">2019</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">58</span>]: cC3.is_date</span><br><span class="line">Out[<span class="number">58</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">59</span>]: cC3.style_id,cC3.style</span><br><span class="line">Out[<span class="number">59</span>]: (<span class="number">2</span>, <span class="string">'常规'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">60</span>]: cC3.font, cC3.fill <span class="comment"># 字体和填充对象较复杂</span></span><br><span class="line">Out[<span class="number">60</span>]:</span><br><span class="line">(&lt;openpyxl.styles.fonts.Font object&gt;</span><br><span class="line"> Parameters:</span><br><span class="line"> name=<span class="string">'宋体'</span>, charset=<span class="number">134</span>, family=<span class="literal">None</span>, b=<span class="literal">False</span>, i=<span class="literal">False</span>, strike=<span class="literal">None</span>, outline=<span class="literal">None</span>,</span><br><span class="line"> shadow=<span class="literal">None</span>, condense=<span class="literal">None</span>, color=<span class="literal">None</span>, extend=<span class="literal">None</span>, sz=<span class="number">12.0</span>, u=<span class="literal">None</span>, vertAlign=<span class="literal">None</span>, scheme=<span class="literal">None</span>,</span><br><span class="line"> &lt;openpyxl.styles.fills.PatternFill object&gt;</span><br><span class="line"> Parameters:</span><br><span class="line"> patternType=<span class="literal">None</span>, fgColor=&lt;openpyxl.styles.colors.Color object&gt;</span><br><span class="line"> Parameters:</span><br><span class="line"> rgb=<span class="string">'00000000'</span>, indexed=<span class="literal">None</span>, auto=<span class="literal">None</span>, theme=<span class="literal">None</span>, tint=<span class="number">0.0</span>, type=<span class="string">'rgb'</span>, bgColor=&lt;openpyxl.styles.colors.Color object&gt;</span><br><span class="line"> Parameters:</span><br><span class="line"> rgb=<span class="string">'00000000'</span>, indexed=<span class="literal">None</span>, auto=<span class="literal">None</span>, theme=<span class="literal">None</span>, tint=<span class="number">0.0</span>, type=<span class="string">'rgb'</span>)</span><br></pre></td></tr></table></figure>
<p>除了通过value属性获取单元格的值，还可以在迭代时明确仅返回值，也就是<code>Worksheet</code>对象的iter_rows、iter_cols方法第5个参数设为True。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按行遍历，生成器转换为元组</span></span><br><span class="line">In [<span class="number">63</span>]: tuple(sh1.iter_rows(sh1.min_row,sh1.max_row,sh1.min_column,sh1.max_column, <span class="literal">True</span>))</span><br><span class="line">Out[<span class="number">63</span>]:</span><br><span class="line">((<span class="string">'列A'</span>, <span class="string">'列B'</span>, <span class="string">'列C'</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="string">'=SUM(A2,B2)'</span>),</span><br><span class="line"> (<span class="number">0.5</span>, <span class="number">-100</span>, datetime.datetime(<span class="number">2019</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)),</span><br><span class="line"> (<span class="literal">True</span>, <span class="number">-0.2</span>, <span class="number">0</span>),</span><br><span class="line"> (<span class="string">'A5'</span>, <span class="literal">None</span>, <span class="literal">None</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按列迭代，访问单元格的值</span></span><br><span class="line">In [<span class="number">64</span>]: <span class="keyword">for</span> col <span class="keyword">in</span> sh1.iter_cols(sh1.min_column,sh1.max_column,sh1.min_row,sh1.max_row,<span class="literal">True</span>): </span><br><span class="line">			<span class="keyword">for</span> val <span class="keyword">in</span> col:  </span><br><span class="line"> 				print(val)</span><br><span class="line"></span><br><span class="line">列A</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0.5</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line">A5 </span><br><span class="line">列B</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">-100</span></span><br><span class="line"><span class="number">-0.2</span></span><br><span class="line"><span class="literal">None</span></span><br><span class="line">列C</span><br><span class="line">=SUM(A2,B2)</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure></p>
<h1 id="0x02-改写文件"><a href="#0x02-改写文件" class="headerlink" title="0x02 改写文件"></a>0x02 改写文件</h1><h2 id="流程概述"><a href="#流程概述" class="headerlink" title="流程概述"></a>流程概述</h2><p>基本流程包括：</p>
<ol>
<li>创建工作簿，即<code>Workbook</code>对象;</li>
<li>向<code>Workbook</code>对象中增加、删除<code>Worksheet</code>对象，也可直接索引需要编辑的<code>Worksheet</code>；</li>
<li>编辑<code>Worksheet</code>对象，包括对单元格赋值，单元格合并、分拆，设置单元格风格，增加、删除行（列），插入图片、图表等；</li>
<li>保存<code>Workbook</code>对象至xlsx格式文件。</li>
</ol>
<h2 id="创建工作簿"><a href="#创建工作簿" class="headerlink" title="创建工作簿"></a>创建工作簿</h2><p>load_workbook函数从已有Excel文件基础上创建，前文已描述。<br>Workbook函数创建新的工作簿，有2个可选参数：</p>
<ul>
<li>write_only，指示是否仅写入，默认False；</li>
<li>iso_dates，指示日期格式，默认False。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">67</span>]: bk2 = openpyxl.Workbook() <span class="comment"># 创建新工作簿</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">68</span>]: bk2.sheetnames <span class="comment"># 默认带了1个表单</span></span><br><span class="line">Out[<span class="number">68</span>]: [<span class="string">'Sheet'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">69</span>]: bk2.active</span><br><span class="line">Out[<span class="number">69</span>]: &lt;Worksheet <span class="string">"Sheet"</span>&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="创建、删除表单"><a href="#创建、删除表单" class="headerlink" title="创建、删除表单"></a>创建、删除表单</h2><p><code>openpyxl</code>中除了<code>Worksheet</code>类，还有个<code>Chartsheet</code>类，文档对其如何使用描述不多，<code>Workbook</code>对象的create_sheet、create_chartsheet方法，分别用于创建这2种表单，均接受2个可选参数：</p>
<ul>
<li>title，指定表单名称，默认None；</li>
<li>index，指定表单序号，默认None，默认插在最后，0为最前，负数表示逆序位置。<br><code>Workbook</code>对象还有个<code>copy_worksheet</code>方法用于复制表单，但<strong>仅限于复制同一个工作簿内的表单，不可跨Workbook对象，而且表单内图片、图表均忽略</strong>，接受1个必选参数，即源<code>Worksheet</code>对象，该<code>Workbook</code>自动将复制的表单插在最后。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">74</span>]: bk2.create_sheet(<span class="string">'表单A'</span>)</span><br><span class="line">Out[<span class="number">74</span>]: &lt;Worksheet <span class="string">"表单A"</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">75</span>]: bk2.active <span class="comment"># 激活表单并未变化</span></span><br><span class="line">Out[<span class="number">75</span>]: &lt;Worksheet <span class="string">"Sheet"</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">76</span>]: bk2.index(bk2[<span class="string">'表单A'</span>]) <span class="comment"># 递增分配序号</span></span><br><span class="line">Out[<span class="number">76</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">77</span>]: bk2.index(bk2.active) </span><br><span class="line">Out[<span class="number">77</span>]: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">78</span>]: bk2[<span class="string">'表单A'</span>].title = <span class="string">'sheetA'</span> <span class="comment"># 通过赋值修改表单名称</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">79</span>]: bk2.sheetnames</span><br><span class="line">Out[<span class="number">79</span>]: [<span class="string">'Sheet'</span>, <span class="string">'sheetA'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># sh1是前文In [13]赋值的表单，即data.xlsx中Sheet1</span></span><br><span class="line">In [<span class="number">81</span>]: sh1cp = bk.copy_worksheet(sh1)</span><br><span class="line"></span><br><span class="line">In [<span class="number">82</span>]: bk.sheetnames <span class="comment"># 默认插在最后</span></span><br><span class="line">Out[<span class="number">82</span>]: [<span class="string">'Sheet1'</span>, <span class="string">'Sheet2'</span>, <span class="string">'Sheet3'</span>, <span class="string">'Sheet1 Copy'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">83</span>]: sh1cp.title <span class="comment"># 默认分配的名称</span></span><br><span class="line">Out[<span class="number">83</span>]: <span class="string">'Sheet1 Copy'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>Workbook</code>对象的remove、remove_sheet方法均可删除表单对象，后者已废弃，建议用前者，仅接受1个必选参数，即要删除的<code>Worksheet</code>对象。这是<code>xlwt</code>所不具备的。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">92</span>]: bk2.remove(bk2[<span class="string">'Sheet'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">93</span>]: bk2.sheetnames</span><br><span class="line">Out[<span class="number">93</span>]: [<span class="string">'sheetA'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">94</span>]: bk.remove(bk[<span class="string">'Sheet2'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">95</span>]: bk.sheetnames</span><br><span class="line">Out[<span class="number">95</span>]: [<span class="string">'Sheet1'</span>, <span class="string">'Sheet3'</span>, <span class="string">'Sheet1 Copy'</span>]</span><br></pre></td></tr></table></figure></p>
<h2 id="编辑数据"><a href="#编辑数据" class="headerlink" title="编辑数据"></a>编辑数据</h2><p><code>Worksheet</code>对象支持通过赋值直接改写单元格，可以写入数字、字符串、日期、公式等等，merge_cells、unmerge_cells可以合并、拆分单元格，整个操作基本和Excel软件的逻辑相近。支持的公式放在<code>openpyxl.utils.FORMULAE</code>变量中，当前3.0版本支持352个公式。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">97</span>]: <span class="keyword">for</span> cx <span class="keyword">in</span> range(<span class="number">2</span>,<span class="number">4</span>):</span><br><span class="line">        	 col = openpyxl.utils.get_column_letter(cx)</span><br><span class="line">        	 sh1[col+<span class="string">'5'</span>] = col+<span class="string">'5'</span> <span class="comment"># 第5行B、C列写入字符串</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">100</span>]: sh1[<span class="string">'A5'</span>] = <span class="string">'=SUM(A1:A4)'</span> <span class="comment"># 写入公式</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">101</span>]: <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">In [<span class="number">102</span>]: sh1[<span class="string">'B1'</span>] = datetime.datetime(<span class="number">2019</span>,<span class="number">12</span>,<span class="number">31</span>) <span class="comment"># 写入日期</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">103</span>]: sh1[<span class="string">'C1'</span>] = <span class="number">-0.0001</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">104</span>]: tuple(sh1.values)</span><br><span class="line">Out[<span class="number">104</span>]:</span><br><span class="line">((<span class="string">'列A'</span>, datetime.datetime(<span class="number">2019</span>, <span class="number">12</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">-0.0001</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="string">'=SUM(A2,B2)'</span>),</span><br><span class="line"> (<span class="number">0.5</span>, <span class="number">-100</span>, datetime.datetime(<span class="number">2019</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)),</span><br><span class="line"> (<span class="literal">True</span>, <span class="number">-0.2</span>, <span class="number">0</span>),</span><br><span class="line"> (<span class="string">'=SUM(A1:A4)'</span>, <span class="string">'B5'</span>, <span class="string">'C5'</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">105</span>]: sh1.merge_cells(<span class="string">'B4:C4'</span>) <span class="comment">#合并单元格，注意值的变化</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">106</span>]: tuple(sh1.values)</span><br><span class="line">Out[<span class="number">106</span>]:</span><br><span class="line">((<span class="string">'列A'</span>, datetime.datetime(<span class="number">2019</span>, <span class="number">12</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">-0.0001</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="string">'=SUM(A2,B2)'</span>),</span><br><span class="line"> (<span class="number">0.5</span>, <span class="number">-100</span>, datetime.datetime(<span class="number">2019</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)),</span><br><span class="line"> (<span class="literal">True</span>, <span class="number">-0.2</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="string">'=SUM(A1:A4)'</span>, <span class="string">'B5'</span>, <span class="string">'C5'</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">108</span>]: len(openpyxl.utils.FORMULAE)</span><br><span class="line">Out[<span class="number">108</span>]: <span class="number">352</span></span><br></pre></td></tr></table></figure></p>
<p><code>Worksheet</code>对象以下方法用于整行（列）增加和删除，但需要注意，<strong>增删行列后，公式所引用的单元格地址并未自动更新，与Excel软件的逻辑 <em>不一致</em> ！</strong></p>
<ul>
<li>insert_rows、insert_cols方法，插入空白行（列），接受2个参数，idx为必选参数，指示插入位置，序号从1起始，amount为默认参数，指示插入多少行（列），默认为1；</li>
<li>delete_rows、delete_cols方法，删除行（列），参数意义与上同。</li>
<li>append方法，在当前表单末尾追加值，如果传入参数是可迭代对象（如list、tuple）就按序填1行，如果传入参数是字典，则按关键字给指定的列填值，关键字可以是列序号或列名。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">110</span>]: sh1.insert_rows(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">111</span>]: sh1.dimensions</span><br><span class="line">Out[<span class="number">111</span>]: <span class="string">'A3:C7'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">112</span>]: sh1.delete_rows(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">113</span>]: sh1.insert_cols(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意公式所引用单元格地址并未自动变化，与Excel软件逻辑不一致！</span></span><br><span class="line">In [<span class="number">114</span>]: tuple(sh1.values) </span><br><span class="line">Out[<span class="number">114</span>]:</span><br><span class="line">((<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="string">'列A'</span>, datetime.datetime(<span class="number">2019</span>, <span class="number">12</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="literal">None</span>, <span class="number">-0.0001</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="literal">None</span>, <span class="string">'=SUM(A2,B2)'</span>),</span><br><span class="line"> (<span class="literal">True</span>, <span class="number">-0.2</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="string">'=SUM(A1:A4)'</span>, <span class="string">'B5'</span>, <span class="literal">None</span>, <span class="string">'C5'</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">115</span>]: sh1.dimensions</span><br><span class="line">Out[<span class="number">115</span>]: <span class="string">'A1:D6'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">120</span>]: sh1.append(range(<span class="number">7</span>)) <span class="comment"># 末尾插入整行</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">122</span>]: sh1.append(&#123;<span class="number">2</span>:<span class="string">'B列'</span>,<span class="number">4</span>:<span class="string">'D列'</span>&#125;) <span class="comment"># 尾行只在B、D列插入值</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">124</span>]: sh1.append(&#123;<span class="string">'B'</span>:<span class="string">'同上'</span>,<span class="string">'D'</span>:<span class="string">'同上'</span>&#125;) <span class="comment"># 尾行只在B、D列插入值</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">125</span>]: tuple(sh1.values)</span><br><span class="line">Out[<span class="number">125</span>]:</span><br><span class="line">((<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="string">'列A'</span>,datetime.datetime(<span class="number">2019</span>, <span class="number">12</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="literal">None</span>, <span class="number">-0.0001</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>), </span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="literal">None</span>, <span class="string">'=SUM(A2,B2)'</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="literal">True</span>, <span class="number">-0.2</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="string">'=SUM(A1:A4)'</span>, <span class="string">'B5'</span>, <span class="literal">None</span>, <span class="string">'C5'</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>), </span><br><span class="line"> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>),</span><br><span class="line"> (<span class="literal">None</span>, <span class="string">'B列'</span>, <span class="literal">None</span>, <span class="string">'D列'</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"> (<span class="literal">None</span>, <span class="string">'同上'</span>, <span class="literal">None</span>, <span class="string">'同上'</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="其他高阶编辑"><a href="#其他高阶编辑" class="headerlink" title="其他高阶编辑"></a>其他高阶编辑</h2><p><code>openpyxl.utils</code>包提供了一些工具函数，辅助数据处理，如前面用到的get_column_letter将列序号转换为列名，还有absolute_coordinate函数将单元格相对引用地址转换为绝对引用地址等等。</p>
<p><code>openpyxl.drawing</code>包可将图片文件转换为<code>Image</code>对象，但需要在Python中事先安装<code>Pillow</code>做后端支持，否则转换报错。<code>Worksheet</code>对象支持通过add_image方法插入图片,接受2个参数：</p>
<ul>
<li>img，必选参数，即<code>Image</code>对象；</li>
<li>anchor，可选参数，指定图片锚定坐标。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">126</span>]: img = openpyxl.drawing.image.Image(<span class="string">'../pic/python-logo.jpg'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">128</span>]: sh1.add_image(img，<span class="string">'F7'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>openpyxl.chart</code>包实现了各种图表类型及对象创建、绘制方法，<code>Worksheet</code>对象支持通过add_chart方法插入图表。图表的绘制过程无法交互，不能实时反映出效果，不如直接在Excel软件中绘制。</p>
<p><code>openpyxl.style</code>包实现了字体、颜色、边框、对齐、填充、风格等多种类型及对象创建、制作方法，<code>Cell</code>对象的font、fill、alignment、style等属性可以直接赋值，实现单元格风格自定义。</p>
<p><code>openpyxl.formatting</code>包实现了风格、规则等类型及对象创建、制作方法，<code>Worksheet</code>对象的conditional_formatting属性，提供了add方法用于添加规格和应用的风格，实现单元格的条件格式。</p>
<p><code>openpyxl.comments</code>包实现了注释类型及对象创建、制作方法，<code>Cell</code>对象的comment属性可以直接赋值，实现单元格添加注释。</p>
<p><code>openpyxl.worksheet</code>包实现了数据有效性等类型及对象创建、制作方法，<code>Worksheet</code>对象提供了add_data_validation方法进行添加，实现单元格数据有效性提示和检验。</p>
<p>上述高阶编辑属于数据处理之后“锦上添花”的功能，但同时编写代码的逻辑繁琐，不如在Excel软件中交互式操作更直观、方便，本文不推荐也不做描述。</p>
<h2 id="保存"><a href="#保存" class="headerlink" title="保存"></a>保存</h2><p>将<code>Workbook</code>对象保存到文件，就1个方法——save，接受参数就1个——文件名。以下示例将上述编辑过的<code>Workbook</code>对象保存至新的Excel文件。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">136</span>]: bk.save(<span class="string">'data-openpyxl.xlsx'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">138</span>]: bk2.save(<span class="string">'bk2-openpyxl.xlsx'</span>)</span><br></pre></td></tr></table></figure></p>
<p>保存后<code>ata-openpyxl.xlsx</code>文件内容如下图。<br><img src="https://pic1.zhimg.com/v2-a5d25bc66ae959323bd757ad714e6a0c_b.png" alt="data-openpyxl.xlsx"></p>
<p>对于保存，有几点需要提醒：</p>
<ol>
<li><strong>Python所有涉及Excel操作的库都不支持“原地编辑与保存”，<code>openpyxl</code>也不例外，“保存”实际上是“另存为”，只是指定保存到原文件的话，原文件被覆盖；</strong></li>
<li><code>openpyxl</code><strong>仅支持xlsx格式，保存的文件名必须使用.xlsx扩展名；</strong></li>
<li>如果创建<code>Workbook</code>对象时使用了write_only模式，则仅能调用save方法一次，不可多次保存。</li>
</ol>
<h1 id="0x03-总结"><a href="#0x03-总结" class="headerlink" title="0x03 总结"></a>0x03 总结</h1><p>从上述读写的示例来看，<code>openpyxl</code>实现一套<code>Workbook</code>、<code>Worksheet</code>、<code>Cell</code>对象用于读写操作，对比之下<code>xlrd/xlwt</code>就显得精神分裂、要逼死强迫症的节奏了。<code>openpyxl</code>对表单、单元格进行索引、访问、赋值等操作的方式和Excel软件的逻辑天然地接近，毫无违和感，覆盖了Excel软件操作的大部分常用功能，同时对外提供的API、参数也不多，易于掌握，对比之下<code>pyexcel</code>满天花式操作、数不清的API和参数让人眼花缭乱。</p>
<p><code>openpyxl</code>堪称优雅的得力干将，唯一的遗憾，大概就是缺少对xls格式的支持。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li>openpyxl Documentation，2019. <a href="https://openpyxl.readthedocs.io" target="_blank" rel="noopener">https://openpyxl.readthedocs.io</a>.</li>
</ul>
<h1 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h1><ul>
<li><a href="2019-12-03-Python操作Excel文件（0）：盘点.html">Python操作Excel文件（0）：盘点</a></li>
<li><a href="2019-08-15-Python项目如何合理组织规避import天坑.html">Python项目如何合理组织规避import天坑</a></li>
<li><a href="2019-02-05-Cygwin前传：从割据到互补.html">Cygwin前传：从割据到互补</a></li>
<li><a href="2019-02-14-Cygwin系列（一）：Cygwin是什么.html">Cygwin系列（一）：Cygwin是什么</a></li>
<li><a href="2019-06-16-Cygwin系列（九）：Cygwin学习路线.html">Cygwin系列（九）：Cygwin学习路线</a></li>
<li><a href="2019-04-04-Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念.html">Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念</a> </li>
<li><a href="2019-05-04-Linux Cygwin知识库（二）：目录、文件及基本操作.html">Linux Cygwin知识库（二）：目录、文件及基本操作</a></li>
<li><a href="https://zhuanlan.zhihu.com/c_1078678205585551360" target="_blank" rel="noopener">专栏：伪码人We_Coder</a></li>
</ul>
<hr>
<p><strong>如本文对你有帮助，或内容引起极度舒适，欢迎分享转发或点击下方捐赠按钮打赏</strong> ^_^</p>
</div><iframe src="/donate/?AliPayQR=/pic/AliPayQR.jpg&amp;WeChatQR=/pic/WeChatQR.png&amp;GitHub=https://github.com/Kaiyuan/donate-page&amp;BTCQR=undefined&amp;BTCKEY=undefined&amp;PayPal=undefined" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>silaoA</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2019/2019-12-20-Python操作Excel文件（3）：优雅干将openpyxl.html">https://silaoa.github.io/2019/2019-12-20-Python操作Excel文件（3）：优雅干将openpyxl.html</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为原创文章，如需转载，请联系stsilaoa@gmail.com 或 公众号 伪码人 或知乎私信 silaoA。</li></ul></div><br><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a class="pre" href="/2019/2019-12-29-Cygwin系列（十）：折腾终端1.html">Cygwin系列（十）：折腾终端1</a><a class="next" href="/2019/2019-12-16-Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils.html">Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://silaoa.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">24</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/Cygwin/" style="font-size: 15px;">Cygwin</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/IEEE/" style="font-size: 15px;">IEEE</a> <a href="/tags/机器人/" style="font-size: 15px;">机器人</a> <a href="/tags/科技/" style="font-size: 15px;">科技</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/WSL/" style="font-size: 15px;">WSL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-29-Cygwin系列（十）：折腾终端1.html">Cygwin系列（十）：折腾终端1</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-20-Python操作Excel文件（3）：优雅干将openpyxl.html">Python操作Excel文件（3）：优雅干将openpyxl</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-16-Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils.html">Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-10-Python操作Excel文件（1）：花式大师pyexcel.html">Python操作Excel文件（1）：花式大师pyexcel</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-03-Python操作Excel文件（0）：盘点.html">Python操作Excel文件（0）：盘点</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-08-28-安装Windows7排除USB3驱动缺失问题的经历.html">安装Windows7排除USB3驱动缺失问题的经历</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-08-15-Python项目如何合理组织规避import天坑.html">Python项目如何合理组织规避import天坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-06-16-Cygwin系列（九）：Cygwin学习路线.html">Cygwin系列（九）：Cygwin学习路线</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-05-25-Cygwin系列（八）：命令行软件包管理器apt-cyg.html">Cygwin系列（八）：命令行软件包管理器apt-cyg</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-05-12-Cygwin系列（七）：Cygwin软件包管理相关配置.html">Cygwin系列（七）：Cygwin软件包管理相关配置</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://silaoa.github.io" title="silaoA的网络日志" target="_blank">silaoA的网络日志</a><ul></ul><a href="http://www.zhihu.com/people/laoa-si/posts" title="silaoA的知乎文章" target="_blank">silaoA的知乎文章</a><ul></ul><a title="微信公众号：伪码人（We_Coder）" target="_blank">微信公众号：伪码人（We_Coder）</a><ul></ul><a title="QQ交流群：374791536" target="_blank">QQ交流群：374791536</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">silaoA的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>