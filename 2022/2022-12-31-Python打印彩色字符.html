<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录分享Cygwin、Linux、编程等计算机技术"><title>Python打印彩色字符 | silaoA的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Python打印彩色字符</h1><a id="logo" href="/.">silaoA的博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Python打印彩色字符</h1><div class="post-meta">Dec 31, 2022<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-Linux终端的颜色"><span class="toc-text">0x00 Linux终端的颜色</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-Windows终端颜色控制"><span class="toc-text">0x01 Windows终端颜色控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用库"><span class="toc-text">使用库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用Win32-API"><span class="toc-text">使用Win32 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初步实现"><span class="toc-text">初步实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#print的彩色包装cprint"><span class="toc-text">print的彩色包装cprint</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-实现终端彩色打印的讨论"><span class="toc-text">0x02 实现终端彩色打印的讨论</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#更多阅读"><span class="toc-text">更多阅读</span></a></li></ol></div></div><div class="post-content"><p>见惯了在黑色终端内输出白色字符，为使输出更有辨识度，我们编写的Python程序如何在终端打印出彩色字符呢？特别是出错的时候，红色字符让用户一下就关注到错误消息，像<code>pip</code>在下载安装库的时候，出错都是大段的红色字符。搜索这个问题的时候，不少教程都是介绍Linux终端打印彩色字符，提及Windows终端如何打印彩色字符的较少，这将是本文重点。</p>
<a id="more"></a>
<!-- [toc] -->
<h1 id="0x00-Linux终端的颜色"><a href="#0x00-Linux终端的颜色" class="headerlink" title="0x00 Linux终端的颜色"></a>0x00 Linux终端的颜色</h1><p>GNU/Linux系统以命令行见长，围绕命令行的生态完备，终端可以配置得花哨绚丽，输出也是多姿多彩。Linux终端对彩色的支持来自于“ANSI Escape Sequence”，即“ANSI转义序列”。<br>ASCII码中除了字母、数字、符号等文本字符外，还有一些不可见的特殊字符，ASCII码值为0~31和127，被称为“控制字符”，用于换行、回退、产生特殊信号等，其中ASCII码值为27的为<code>ESC</code>，即Escape，跟在<code>ESC</code>之后的若干字符组成转义序列，可以控制光标移动、闪烁、擦除、<strong>产生颜色</strong>等，关于转义序列，在<a href="/2019/2019-12-29-Cygwin系列（十）：折腾终端1.html">Cygwin系列（十）：折腾终端1</a> 文中已有介绍，详见<a href="https://en.wikipedia.org/wiki/ANSI_escape_code" target="_blank" rel="noopener">维基百科 ANSI_escape_code</a>。</p>
<p>Linux的终端都能很好地支持ANSI标准，按照标准准备好转义序列和字符就打印出彩色字符，使用Shell、C、Python等任何语言都可以做到。转义序列的起始字符<code>ESC</code>怎么表达？显然不是<code>E</code>、<code>S</code>、<code>C</code>三个字符，ANSI规定可以用转义字符<code>\e</code>（<strong>又是转义</strong>）来表示，或者用ASCII码值转义形式<code>\033</code>表示，<code>033</code>代表8进制33，等于10进制27。转义序列<code>\e[&lt;颜色代码&gt;mtext</code>，用于控制文本“text”的颜色显示效果，其中&lt;颜色代码&gt;包括前景色、背景色，多个代码用分号隔开，颜色代码取值如下，要设置高亮，在下表前景或背景颜色代码基础上加60即可。<br><img src="https://pic1.zhimg.com/80/v2-8962eb3263f2af33cc2a3cbc6a0b26a3_720w.png" alt></p>
<p>前景和背景色代码数值范围不同，在转义序列中二者位置互换不影响效果，终端能够根据数值不同区分开来，如<code>\e[32;40m</code>和<code>\e[40;32m</code>都合法且效果一样，都是设置背景黑色、前景绿色。还有一个特殊颜色代码<code>\e[0m</code>表示关闭所有设置<strong>恢复到默认状态</strong>，通常会加在要打印的文本之后，这样不影响下一段输出，做到每个字符独立控制颜色。</p>
<p>有了以上理论基础，就可以使用Python、Shell等来控制字符颜色了，如下可以打印出黑底红色字和白底蓝色字，并且“这是”、“和”为默认色。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"这是\e[31;40m黑底红色 \e[0m和 \e[34;47m白底蓝色 \e[0m"</span>)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">"这是\e[31;40m黑底红色 \e[0m和 \e[34;47m白底蓝色 \e[0m"</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic1.zhimg.com/80/v2-95b7b6a39a0ef537163bce63c1ff0030_720w.webp" alt><br><strong>以上是8色终端的情况，对于支持256色的终端，颜色转义序列更为复杂</strong>，在此不展开说了。</p>
<h1 id="0x01-Windows终端颜色控制"><a href="#0x01-Windows终端颜色控制" class="headerlink" title="0x01 Windows终端颜色控制"></a>0x01 Windows终端颜色控制</h1><p>Windows以图形界面见长，对命令行的生态支持力度不足，Windows的终端属于Console组件，并<strong>不支持ANSI转义序列</strong>，要打印彩色字符就要另寻他计。<br>另一方面，个人觉得转义序列可读性太差，且颜色样式与文本混在一起输出，不够优雅。</p>
<h2 id="使用库"><a href="#使用库" class="headerlink" title="使用库"></a>使用库</h2><p>Python上有些第三方库增加了终端高亮和色彩渲染功能。</p>
<p>第1个<code>Rich</code>，字面意思表示“富文本”，文档地址：<a href="https://rich.readthedocs.io/en/latest/introduction.html" target="_blank" rel="noopener">https://rich.readthedocs.io/en/latest/introduction.html</a>。具有以下特性：</p>
<ul>
<li>跨平台，Windows、Linux、MacOS都可用；</li>
<li>可与Jupyter Notebook配合使用；</li>
<li>导出了同名函数<code>print</code>，理论上可以替代Python内置的<code>print</code>；</li>
<li>支持表格框线、进度线、目录树线等的色彩渲染；</li>
<li>支持Markdown渲染、语法高亮（依赖<code>pygments</code>库）。<br>还有更多功能特性不再展开说了，就打印输出而言，是通过成对标签将要颜色渲染的文本包起来，类似于写html那样，可读性是比ANSI转义序列好些了，但仍然是样式与文本混合输出。<code>Rich</code>库的功能特性过于繁杂，远远超过“在终端打印彩色字符”的需求，感觉更像是开发文本编辑器、终端模拟器的支持包。</li>
</ul>
<p>第2个<code>colorama</code>，基本上就是ANSI转义序列的包装，<code>ipython</code>就用到了它，项目官网<a href="https://github.com/tartley/colorama" target="_blank" rel="noopener">https://github.com/tartley/colorama</a>。<code>colorama</code>将颜色样式转义序列做了名称定义，引用时直接用颜色变量即可，前一节的颜色在<code>colorama</code>里变成了<code>Fore.RED</code>（前景红色）、<code>Back.GREEN</code>（背景绿色）等；另外导出了一个<code>Colored</code>类，使用<code>Colored.blue</code>、<code>Colored.yellow</code>等成员函数，可以将传入的字符串文本加上转义序列输出，供下一步<code>print</code>。</p>
<p><code>colorama</code>功能极简、用法极简，而且跨平台。在支持ANSI转义序列的平台（Linux、MacOS）<code>colorama</code>除了颜色定义替换基本上啥也没做，在不支持ANSI转义序列的平台（Windows），<code>colorama</code>将打印文本中的颜色变量剔除掉，变成调用该平台的API来实现颜色样式设定。<code>colorama</code>已经很贴近需求了。</p>
<h2 id="使用Win32-API"><a href="#使用Win32-API" class="headerlink" title="使用Win32 API"></a>使用Win32 API</h2><p>Windows不支持ANSI转义序列，但有Win32 API可以设置终端样式，但Python如何调用呢？Python标准库中，<code>ctypes</code>库可以加载外部动态库，这样可以把核心功能用其他语言（比如C/C++）编写提高运行效率，Python程序制作包装，对Python用户而言接口一致。<code>ctypes</code>自然能加载Windows dll，实现对Win32 API调用，其中<code>SetConsoleTextAttribute</code>函数就是设置终端文本属性，用于控制彩色打印，它有2个参数：</p>
<ul>
<li>参数1：handle，表示要控制谁，包括标准输入、标准输出、标准错误，取值通过<code>GetStdHandle</code>函数获得；</li>
<li>参数2：color，表示颜色设定，取值为1个字节整数，高4位是背景色、低4位是前景色，含义一致，如下所示。4位设定中，最高位为强调（高亮）位，接下来3位是RGB三原色输出，0表示三原色均无输出，即黑色，7表示三原色均输出，即白色；3位组合共8种颜色取值，与ANSI转义序列一样，只是取值不同，结合高亮位，背景、前景各16种取值。<br><img src="https://pic4.zhimg.com/80/v2-0a631994486d29ba71e9f5b742b6b4ff_720w.webp" alt><br><img src="https://pic3.zhimg.com/80/v2-65eb1202ecfeef4aaf52f299e17e1e76_720w.webp" alt></li>
</ul>
<h2 id="初步实现"><a href="#初步实现" class="headerlink" title="初步实现"></a>初步实现</h2><p>有了以上理论铺垫，可以写代码尝试了。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">handle = ctypes.windll.kernel32.GetStdHandle(<span class="number">-11</span>)</span><br><span class="line">fg, bg = <span class="number">6</span>, <span class="number">7</span> <span class="comment"># 设置背景色、前景色</span></span><br><span class="line">color =  fg + bg&lt;&lt;<span class="number">4</span></span><br><span class="line">ctypes.windll.kernel32.SetConsoleTextAttribute(handle, color)</span><br><span class="line">print(<span class="string">"彩色文本"</span>)</span><br><span class="line">fg, bg = <span class="number">7</span>, <span class="number">0</span> <span class="comment"># 恢复背景黑、前景白</span></span><br><span class="line">color =  fg + bg&lt;&lt;<span class="number">4</span></span><br><span class="line">ctypes.windll.kernel32.SetConsoleTextAttribute(handle, color)</span><br></pre></td></tr></table></figure></p>
<p>上述代码片段解释如下：</p>
<ul>
<li>第2行获得要控制的handle，-11表示控制标准输出，-10和-12对应标准输入、标准错误；</li>
<li>第3、4行设置color，可根据需要调整；</li>
<li>第5行设定了终端文本属性；</li>
<li>第6行将文本打印出来，终端将按照第5句渲染结果；</li>
<li>第7~9行恢复成默认色，背景黑、前景白。</li>
</ul>
<p>按照过程其实就4步：获得标准输出句柄，设置终端属性，打印，恢复终端属性。把这4步封装成一个函数则更好用。</p>
<h2 id="print的彩色包装cprint"><a href="#print的彩色包装cprint" class="headerlink" title="print的彩色包装cprint"></a>print的彩色包装cprint</h2><p>用“Python打印彩色字符”为关键字搜索，搜索结果千篇一律的介绍都是编写一个类，给每种彩色打印编一个成员函数，前景、背景256种组合难道配256个成员函数？这种设计未免太傻。</p>
<p>打印使用的是<code>print</code>函数，不需再实现了，我们所需要的是对<code>print</code>包装形成<code>cprint</code>函数（c代表colored），为方便独立设置前景、背景色，增加<code>fg</code>、<code>bg</code>两个参数。捋一下思路：</p>
<ul>
<li>接口设计为<code>cprint(text, fg=None, bg=None)</code>，如果<code>fg</code>、<code>bg</code>都为默认值<code>None</code>则不做任何处理直接打印，<code>text</code>传给<code>print</code>，但这样仅打印字符串，限定了<code>print</code>功能；</li>
<li>接口设计为<code>cprint(fg=None, bg=None, *args, **kargs)</code>，可变参数<code>args</code>和关键字参数<code>kargs</code>原封不动传给<code>print</code>，这样保证<code>print</code>接口一致，而且Python规定可变参数和关键字参数必须放在最后，这样只能把<code>fg</code>和<code>bg</code>放在前面；</li>
<li>接口设计为<code>cprint(*values, sep=&#39;&#39;, end=&#39;\n&#39;, file=sys.stdout, flush=False, fg=None, bg=None)</code>，这样把<code>print</code>的5个参数都照顾到了，但在实际使用最多的是只传<code>values</code>值其他为默认，<code>fg</code>、<code>bg</code>位置在最后，要传值则只能使用关键字参数形式。<br>综合权衡，第2种接口最好，第1种最简单但也最差。</li>
</ul>
<p>为使传<code>fg</code>、<code>bg</code>更简便，将颜色值及代码以字典形式存起来，增设了”reset”颜色名称用于指示默认色，函数中仅对有效参数处理，形成代码如下。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cprint</span><span class="params">(fg=None, bg=None, *args, **kargs)</span>:</span></span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	print的包装，在终端打印带颜色的文本</span></span><br><span class="line"><span class="string">	[参数]</span></span><br><span class="line"><span class="string">		fg：前景色</span></span><br><span class="line"><span class="string">		bg：背景色，支持颜色字符串和</span></span><br><span class="line"><span class="string">		其他参数，原封不动传递给print</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	<span class="keyword">if</span>(sys.platform == <span class="string">"win32"</span>):</span><br><span class="line">		<span class="keyword">import</span> ctypes</span><br><span class="line">		</span><br><span class="line">		STD_INPUT_HANDLE = <span class="number">-10</span></span><br><span class="line">		STD_OUTPUT_HANDLE= <span class="number">-11</span></span><br><span class="line">		STD_ERROR_HANDLE = <span class="number">-12</span></span><br><span class="line">		fg_colors=&#123;</span><br><span class="line">			<span class="string">"black"</span>:<span class="number">0</span>, <span class="string">"blue"</span>:<span class="number">1</span>, <span class="string">"green"</span>:<span class="number">2</span>,<span class="string">"cyan"</span>:<span class="number">3</span>,</span><br><span class="line">			<span class="string">"red"</span>:<span class="number">4</span>,<span class="string">"purple"</span>:<span class="number">5</span>,<span class="string">"yellow"</span>:<span class="number">6</span>,<span class="string">"white"</span>:<span class="number">7</span>,</span><br><span class="line">			<span class="string">"grey"</span>:<span class="number">8</span>, <span class="string">"light blue"</span>:<span class="number">9</span>,<span class="string">"light green"</span>:<span class="number">10</span>,<span class="string">"light cyan"</span>:<span class="number">11</span>,</span><br><span class="line">			<span class="string">"light red"</span>:<span class="number">12</span>,<span class="string">"light purple"</span>:<span class="number">13</span>,<span class="string">"light yellow"</span>:<span class="number">14</span>,<span class="string">"light white"</span>:<span class="number">15</span>,</span><br><span class="line">			<span class="string">"reset"</span>:<span class="number">7</span> <span class="comment"># 增加"reset"作为恢复状态</span></span><br><span class="line">			&#125;</span><br><span class="line">		bg_colors = &#123;k:v&lt;&lt;<span class="number">4</span> <span class="keyword">for</span> k,v <span class="keyword">in</span> fg_colors.items()&#125;</span><br><span class="line">		bg_colors[<span class="string">"reset"</span>] = <span class="number">0</span> <span class="comment"># 背景黑</span></span><br><span class="line">		handle = ctypes.windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)</span><br><span class="line">		fcolor, bcolor = fg_colors[<span class="string">"reset"</span>], bg_colors[<span class="string">"reset"</span>] <span class="comment"># 默认背景黑、前景白</span></span><br><span class="line">		<span class="comment"># fg、bg参数，既支持字典key、也支持字典value</span></span><br><span class="line">		<span class="keyword">if</span>( (fg,bg) != (<span class="literal">None</span>, <span class="literal">None</span>) ):</span><br><span class="line">			<span class="keyword">if</span>( fg <span class="keyword">in</span> fg_colors.keys() ):</span><br><span class="line">				fcolor = fg_colors[fg]</span><br><span class="line">			<span class="keyword">elif</span>( fg <span class="keyword">in</span> fg_colors.values()):</span><br><span class="line">				fcolor = fg</span><br><span class="line">			<span class="keyword">if</span>( bg <span class="keyword">in</span> bg_colors.keys() ):</span><br><span class="line">				bcolor = bg_colors[bg]</span><br><span class="line">			<span class="keyword">elif</span>( bg <span class="keyword">in</span> bg_colors.values() ):</span><br><span class="line">				bcolor = bg</span><br><span class="line">			color = fcolor | bcolor</span><br><span class="line">			ctypes.windll.kernel32.SetConsoleTextAttribute(handle, color)</span><br><span class="line">	print(*args, **kargs)</span><br><span class="line">	<span class="keyword">if</span>(sys.platform == <span class="string">"win32"</span>):</span><br><span class="line">		<span class="keyword">if</span>( (fg,bg) != (<span class="literal">None</span>, <span class="literal">None</span>) ):</span><br><span class="line">			color = fg_colors[<span class="string">"reset"</span>] | bg_colors[<span class="string">"reset"</span>]</span><br><span class="line">			ctypes.windll.kernel32.SetConsoleTextAttribute(handle, color)</span><br></pre></td></tr></table></figure></p>
<p>下面来测试，将前景、背景256种组合打印出来，打印内容为整数0~255。假设<code>cprint</code>已经被<code>import</code>，以下代码利用<code>y</code>和<code>x</code>分别控制行和列，取值范围都是0~15，同时<code>x</code>是前景色、<code>y&lt;&lt;4</code>为背景色，<code>(y&lt;&lt;4)|x</code>为要打印的整数，每打印一个数不立即换行，而是设置<code>end=&quot;\t&quot;</code>打印制表符，每行16列打印完后再换行。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">		cprint(x,y&lt;&lt;<span class="number">4</span>,(y&lt;&lt;<span class="number">4</span>)|x, end=<span class="string">"\t"</span>)</span><br><span class="line">	print(<span class="string">"\n"</span>)</span><br></pre></td></tr></table></figure></p>
<p>效果如下，每行应用1种背景色、16种前景色，逐行输出，主对角线上的数值由于背景、前景相同而无法显示出来。从这看出来第2种接口比第1种的好处了，像<code>end</code>这样的参数可以自由控制。<br><img src="https://pic1.zhimg.com/80/v2-0f4683f1a42793ca19bc3f74d983b914_720w.webp" alt><br>以上实现了<code>print</code>轻量级包装，即wrapper。</p>
<h1 id="0x02-实现终端彩色打印的讨论"><a href="#0x02-实现终端彩色打印的讨论" class="headerlink" title="0x02 实现终端彩色打印的讨论"></a>0x02 实现终端彩色打印的讨论</h1><p>对于<code>cprint</code>的接口，还一种设计是将<code>fg</code>、<code>bg</code>合成为一个参数，需要用户把高4位、低4位或运算后再传值，但这样就不能直接应用颜色字符串，而是要用颜色常量，比如定义为”RED”、”GREEN”等，传值使用“(RED&lt;&lt;4) | GREEN”的形式，函数使用起来稍复杂一点点，也是可以的。如下，<code>cprint2</code>接口少一个参数，参数检查也更简单，移位、或运算操作留给用户。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">STD_INPUT_HANDLE = <span class="number">-10</span></span><br><span class="line">STD_OUTPUT_HANDLE= <span class="number">-11</span></span><br><span class="line">STD_ERROR_HANDLE = <span class="number">-12</span></span><br><span class="line">BLACK = <span class="number">0</span></span><br><span class="line">BLUE = <span class="number">1</span></span><br><span class="line">GREEN = <span class="number">2</span></span><br><span class="line">CYAN = <span class="number">3</span></span><br><span class="line">RED = <span class="number">4</span></span><br><span class="line">PURPLE = <span class="number">5</span></span><br><span class="line">YELLOW = <span class="number">6</span></span><br><span class="line">WHITE = <span class="number">7</span></span><br><span class="line">GREY = <span class="number">8</span></span><br><span class="line">LIGHT_BLUE = <span class="number">9</span></span><br><span class="line">LIGHT_GREEN = <span class="number">10</span></span><br><span class="line">LIGHT_CYAN = <span class="number">11</span></span><br><span class="line">LIGHT_RED = <span class="number">12</span></span><br><span class="line">LIGHT_PURPLE = <span class="number">13</span></span><br><span class="line">LIGHT_YELLOW = <span class="number">14</span></span><br><span class="line">LIGHT_WHITE = <span class="number">15</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cprint2</span><span class="params">(color=None, *args, **kargs)</span>:</span></span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	print的包装，在终端打印带颜色的文本</span></span><br><span class="line"><span class="string">	[参数]</span></span><br><span class="line"><span class="string">		color：背景色|前景色形式，8位数字</span></span><br><span class="line"><span class="string">		其他参数，原封不动传递给print</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	<span class="keyword">if</span>(sys.platform == <span class="string">"win32"</span>):</span><br><span class="line">		<span class="keyword">import</span> ctypes</span><br><span class="line">		<span class="keyword">if</span>(color <span class="keyword">in</span> range(<span class="number">256</span>)):</span><br><span class="line">			handle = ctypes.windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)</span><br><span class="line">			ctypes.windll.kernel32.SetConsoleTextAttribute(handle, color)</span><br><span class="line">	print(*args, **kargs)</span><br><span class="line">	<span class="keyword">if</span>(sys.platform == <span class="string">"win32"</span>):</span><br><span class="line">		<span class="keyword">if</span>( color <span class="keyword">in</span> range(<span class="number">256</span>) ):</span><br><span class="line">			ctypes.windll.kernel32.SetConsoleTextAttribute(handle, (BLACK&lt;&lt;<span class="number">4</span>)|WHITE)</span><br></pre></td></tr></table></figure></p>
<p><code>cprint</code>两种实现，首先检测了系统平台，如果是Windows才会进一步检查参数有效性并使用<code>ctypes</code>库调用Win32 API；如果是其他，比如Linux、MacOS，则丢掉颜色参数，直接打印。</p>
<p><strong>如果程序中除了<code>print</code>还有自定义的log等函数，更优雅的思路是装饰器，在需要彩色输出的函数定义前装饰即可。</strong></p>
<p>综上，终端打印彩色字符，总体来说包括颜色样式与文本分离和混合两大类，但个人认为分离更好：</p>
<ul>
<li><strong>可读性更强</strong>，颜色样式与文本混合，无论是转义序列还是标签，可读性都较差；</li>
<li><strong>改造工作量小</strong>，对现有代码中的<code>print</code>函数，在<code>print</code>前面加上<code>c</code>，再在参数列表前头加上前景、背景色即可，比转义序列的；</li>
<li><strong>不依赖第三库</strong>，使用标准库<code>ctypes</code>即可，方便他人使用和打包；</li>
<li>在有重定向、管道输出的场合，比如输出到日志文件，<strong>不会输出颜色样式的转义序列或者标签，不打乱上层的函数调用</strong>。<br>其中，最后两点个人认为尤需重视。</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://rich.readthedocs.io/en/latest/introduction.html" target="_blank" rel="noopener">Rich Documentation</a>.</li>
<li><a href="https://github.com/tartley/colorama" target="_blank" rel="noopener">https://github.com/tartley/colorama</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/ANSI_escape_code" target="_blank" rel="noopener">维基百科：ANSI_escape_code</a>.</li>
<li><a href="https://zh.wikipedia.org/wiki/Win32%E6%8E%A7%E5%88%B6%E5%8F%B0" target="_blank" rel="noopener">维基百科：Win32 控制台</a>.</li>
<li><a href="https://learn.microsoft.com/zh-cn/windows/console/console-screen-buffers#character-attributes" target="_blank" rel="noopener">Windows文档：控制台屏幕缓冲区</a>.</li>
</ul>
<h1 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h1><ul>
<li><a href="https://zhuanlan.zhihu.com/p/102460964" target="_blank" rel="noopener">知乎专栏目录导航</a></li>
<li><a href="/2019/2019-12-29-Cygwin系列（十）：折腾终端1.html">Cygwin系列（十）：折腾终端1</a>* <a href="/2019/2019-04-04-Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念.html">Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念</a></li>
<li><a href="/2019/2019-08-15-Python项目如何合理组织规避import天坑.html">Python项目如何合理组织规避import天坑</a></li>
<li><a href="/2019/2019-02-14-Cygwin系列（一）：Cygwin是什么.html">Cygwin系列（一）：Cygwin是什么</a></li>
<li><a href="/2019/2019-12-03-Python操作Excel文件（0）：盘点.html">Python操作Excel文件（0）：盘点</a></li>
<li><a href="/2019/2019-06-16-Cygwin系列（九）：Cygwin学习路线.html">Cygwin系列（九）：Cygwin学习路线</a></li>
<li><a href="/2019/2019-05-08-微软WSL——Linux桌面未来之光.html">微软WSL——Linux桌面版未来之光</a></li>
</ul>
<hr>
<p>如本文对你有帮助，或内容引起极度舒适，欢迎分享转发与留言交流<br><img src="https://pic3.zhimg.com/80/v2-2c41616595fb74ec5acfbabe9e0e125a_hd.jpg" alt><br><img src="https://pic2.zhimg.com/80/v2-2e15831707f8c58cbb6cfbf0df5a7b41_hd.jpg" alt><br>►本文为原创文章，如需转载请私信知乎账号silaoA或联系公众号伪码人（We_Coder）。</p>
<p><strong>都看这里了，不妨点个赞再走呗</strong></p>
</div><iframe src="/donate/?AliPayQR=/pic/AliPayQR.jpg&amp;WeChatQR=/pic/WeChatQR.png&amp;GitHub=https://github.com/Kaiyuan/donate-page&amp;BTCQR=undefined&amp;BTCKEY=undefined&amp;PayPal=undefined" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>silaoA</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2022/2022-12-31-Python打印彩色字符.html">https://silaoa.github.io/2022/2022-12-31-Python打印彩色字符.html</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为原创文章，如需转载，请联系stsilaoa@gmail.com 或 公众号 伪码人 或知乎私信 silaoA。</li></ul></div><br><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a class="next" href="/2022/2022-04-23-Linux Cygwin知识库：图形技术栈.html">Linux Cygwin知识库：图形技术栈</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://silaoa.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">31</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/Cygwin/" style="font-size: 15px;">Cygwin</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/IEEE/" style="font-size: 15px;">IEEE</a> <a href="/tags/机器人/" style="font-size: 15px;">机器人</a> <a href="/tags/科技/" style="font-size: 15px;">科技</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/WSL/" style="font-size: 15px;">WSL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/2022-12-31-Python打印彩色字符.html">Python打印彩色字符</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/2022-04-23-Linux Cygwin知识库：图形技术栈.html">Linux Cygwin知识库：图形技术栈</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/2021-10-30-Cygwin系列（十三）：折腾X.html">Cygwin系列（十三）：折腾X</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/2021-06-02-WSLg：为WSL增光添彩.html">WSLg：为WSL增光添彩</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/2020-11-27-Python自动操作GUI神器PyAutoGUI.html">Python自动操作GUI神器PyAutoGUI</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/2020-04-25-Cygwin系列（十二）：了解X.html">Cygwin系列（十二）：了解X</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/2020-01-13-Cygwin系列（十一）：折腾终端2.html">Cygwin系列（十一）：折腾终端2</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-29-Cygwin系列（十）：折腾终端1.html">Cygwin系列（十）：折腾终端1</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-20-Python操作Excel文件（3）：优雅干将openpyxl.html">Python操作Excel文件（3）：优雅干将openpyxl</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-16-Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils.html">Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://silaoa.github.io" title="silaoA的博客" target="_blank">silaoA的博客</a><ul></ul><a href="https://zhuanlan.zhihu.com/p/102460964" title="silaoA的知乎文章导航" target="_blank">silaoA的知乎文章导航</a><ul></ul><a title="微信公众号：伪码人（We_Coder）" target="_blank">微信公众号：伪码人（We_Coder）</a><ul></ul><a title="QQ交流群：374791536" target="_blank">QQ交流群：374791536</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">silaoA的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>