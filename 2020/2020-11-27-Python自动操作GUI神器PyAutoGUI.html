<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录分享Cygwin、Linux、编程等计算机技术"><title>Python自动操作GUI神器PyAutoGUI | silaoA的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Python自动操作GUI神器PyAutoGUI</h1><a id="logo" href="/.">silaoA的博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Python自动操作GUI神器PyAutoGUI</h1><div class="post-meta">Nov 27, 2020<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-PyAutoGUI简介"><span class="toc-text">0x00 PyAutoGUI简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-PyAutoGUI使用入门"><span class="toc-text">0x01 PyAutoGUI使用入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#快速上手"><span class="toc-text">快速上手</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-任务示例"><span class="toc-text">0x02 任务示例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#更多阅读"><span class="toc-text">更多阅读</span></a></li></ol></div></div><div class="post-content"><p>本文共3500余字，预计阅读时间12分钟，本文同步发布于<a href="https://zhuanlan.zhihu.com/p/302592540" target="_blank" rel="noopener">知乎专栏</a>和微信公众号平台。<br>关注学习了解更多的Cygwin、Linux、Python技术。</p>
<p>日常使用计算机，命令行程序可以说是为批量操作文件而生，但作为普通用户，最多的还是通过鼠标键盘操作形形色色的图形界面程序。试想下面一个场景：有成千上万个文件，都需要通过图形界面进行同样的一套编辑、保存工作，靠手工一遍一遍地重复做，累死人不说，时间久了必然出现错误，<strong>作为程序猿，怎么能忍重复3次以上的工作，必须利用程序自动化</strong>。要想图形界面也能像命令行程序那样精确控制，就需要GUI自动化工具了。不得不赞Python生态之丰富，GUI自动化自动化工具也有多种库可选，比如Windows平台的pywin32，以及本文主角——跨平台的PyAutoGUI。</p>
<a id="more"></a>
<h1 id="0x00-PyAutoGUI简介"><a href="#0x00-PyAutoGUI简介" class="headerlink" title="0x00 PyAutoGUI简介"></a>0x00 PyAutoGUI简介</h1><p><code>pywin32</code>直接包装了几乎所有的Windows API，可以方便地从Python直接调用，把Windows API按照功能分了一些大类，每一个大类作为一个模块，常见如<code>win32api</code>、<code>win32gui</code>、<code>win32com</code>等，其中<code>win32com</code>使用微软独门的COM接口技术进行进程间通信，可以实现控制GUI程序。但前提是，这些程序得支持COM接口。<code>win32api</code>则更加原始，完全通过Win32 API调用获得/生成窗口句柄、发送消息事件，十分繁琐。还有的项目如<a href="https://github.com/pywinauto/pywinauto" target="_blank" rel="noopener">pywinauto</a>，则是在<code>pywin32</code>基础上进一步封装，但本质思路还是一样的。</p>
<p><code>PyAutoGUI</code>的思路与此完全不同，它是接管了鼠标、键盘使用权，基本上完全照搬人的操作，底层不必套牢在Windows系统，没错，它是<strong>跨平台</strong>的。官网地址：<a href="https://github.com/asweigart/pyautogui" target="_blank" rel="noopener">https://github.com/asweigart/pyautogui</a>。原本，这类GUI自动化工具的初衷是给GUI程序自动化测试用，产生点击鼠标、敲击键盘的行为，在日志中记录下消息事件和GUI程序的响应结果，事后分析GUI程序可能存在的bug。不过，既然能产生点击鼠标、敲击键盘的行为，我们就可以用来控制GUI程序批量完成文件编辑、保存工作。</p>
<p>按照官方的说法，<code>PyAutoGUI</code>是给人类用的GUI自动化神器，简单高效、函数分类清晰，它被<a href="https://github.com/vinta/awesome-python" target="_blank" rel="noopener">awesome-python</a>、<a href="https://github.com/jobbole/awesome-python-cn" target="_blank" rel="noopener">awesome-python-cn</a>收录。</p>
<h1 id="0x01-PyAutoGUI使用入门"><a href="#0x01-PyAutoGUI使用入门" class="headerlink" title="0x01 PyAutoGUI使用入门"></a>0x01 PyAutoGUI使用入门</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>推荐通过pip安装，一行命令搞定。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install -U pyautogui</span><br></pre></td></tr></table></figure></p>
<p><code>PyAutoGUI</code>依赖于<code>pyscreeze</code>、<code>pymsgbox</code>、<code>pytweening</code>，上述命令会自动安装这3个库。安装完成后可以发现，在site-packages\pyautogui有6个文件，名字带java、osx、win、x11的是在不同平台的实现方案，再在<strong>init</strong>.py和<strong>main</strong>.py中检测当前系统平台进行封装。其中，java平台的实现文件为空，猜测是未来计划支持的，先占个坑。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__init__.py</span><br><span class="line">__main__.py</span><br><span class="line">_pyautogui_java.py  <span class="comment"># 空文件，猜测是未来支持</span></span><br><span class="line">_pyautogui_osx.py</span><br><span class="line">_pyautogui_win.py</span><br><span class="line">_pyautogui_x11.py</span><br></pre></td></tr></table></figure></p>
<h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><p><code>PyAutoGUI</code>设计简洁，相关符号经过内部<code>import</code>之后，被封装在<code>pyautogui</code>单个模块中，因此Python程序中只要<code>import pyautogui</code>之后便可通过<code>.</code>符号访问<code>pyautogui</code>中的函数、变量。<code>pyautogui</code>中函数大致分为通用功能、鼠标控制、键盘控制、消息窗口、截图5大类。 </p>
<ol>
<li>通用功能<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> pyautogui</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: pyautogui.size()  <span class="comment"># 获取屏幕尺寸（分辨率×分辨率）</span></span><br><span class="line">Out[<span class="number">2</span>]: Size(width=<span class="number">1920</span>, height=<span class="number">1080</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: pyautogui.position() <span class="comment"># 获取鼠标当前位置</span></span><br><span class="line">Out[<span class="number">3</span>]: Point(x=<span class="number">846</span>, y=<span class="number">437</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: pyautogui.onScreen(<span class="number">100</span>,<span class="number">200</span>) <span class="comment"># 判断坐标是否在屏幕范围内</span></span><br><span class="line">Out[<span class="number">4</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: pyautogui.onScreen(<span class="number">100</span>,<span class="number">2000</span>) <span class="comment"># 判断坐标是否在屏幕范围内</span></span><br><span class="line">Out[<span class="number">5</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>坐标体系至关重要，后续鼠标位置、图片大小都根据这套体系定义。PyAutoGUI沿用了传统的坐标体系，并未重新定义，如下图所示。x的取值范围是[0, 宽度分辨率-1]，y的取值范围是[0, 高度分辨率-1]。<br><img src="https://pic4.zhimg.com/80/v2-23b0c0466ae08e8a3f370c5b46bb1217_720w.jpg" alt="屏幕坐标体系"></p>
<ol start="2">
<li>鼠标控制<br>鼠标移动，包括绝对位置移动和相对位置移动。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: sizex,sizey=pyautogui.size() <span class="comment"># 保存屏幕尺寸</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绝对位置移动，移动至屏幕正中心，鼠标移动过渡时间duration设为1秒</span></span><br><span class="line">In [<span class="number">9</span>]: pyautogui.moveTo(sizex/<span class="number">2</span>,sizey/<span class="number">2</span>,duration=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相对位置移动，向右100、向上200，鼠标移动过渡时间duration设为0.5秒</span></span><br><span class="line">In [<span class="number">10</span>]: pyautogui.moveRel(<span class="number">100</span>, <span class="number">-200</span>, duration=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>鼠标点击，一个<code>click()</code>函数把点鼠标的活包干，过程也可分解为<code>mouseDown()</code>、<code>mouseUp()</code>；另有在<code>click()</code>之上封装的<code>rightClick()</code>、<code>middleClick()</code>、<code>doubleClick()</code>、<code>tripleClick()</code>等函数。<strong>鼠标点击之前允许指定要移动的目标位置，若目标位置不在运行当前Python程序的终端/IDE范围内，则可能对其他GUI程序触发鼠标点击事件，从而引起其响应，即焦点移动至其他GUI程序。</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 移动至屏幕中心点击一下左键，过渡时间0.5秒</span></span><br><span class="line">In [<span class="number">16</span>]: pyautogui.click(sizex/<span class="number">2</span>,sizey/<span class="number">2</span>, duration=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不指定x、y，在当前位置点击一下右键</span></span><br><span class="line">In [<span class="number">17</span>]: pyautogui.click(button=<span class="string">'right'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动至(100,100)点击3次左键，点击间隔0.1s，鼠标移动过渡时间0.5秒</span></span><br><span class="line">In [<span class="number">18</span>]: pyautogui.click(<span class="number">100</span>,<span class="number">100</span>, clicks=<span class="number">3</span>,interval=<span class="number">0.1</span>,duration=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动至(100,100)点击2次右键，点击间隔0.5s，鼠标移动过渡时间0.2秒</span></span><br><span class="line">In [<span class="number">19</span>]: pyautogui.click(<span class="number">100</span>,<span class="number">100</span>, clicks=<span class="number">2</span>,interval=<span class="number">0.5</span>,button=<span class="string">'right'</span>,duration=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure></p>
<p>滚动鼠标滚轮。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 鼠标位置不动，向上回滚2个单位，项目文档对滚动量参数说明不详</span></span><br><span class="line">In [<span class="number">22</span>]: pyautogui.scroll(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 鼠标移动至(1000,700)，前下滚动10个单位</span></span><br><span class="line"><span class="comment"># 运行发现鼠标并没有动</span></span><br><span class="line">In [<span class="number">26</span>]: pyautogui.scroll(<span class="number">-10</span>,<span class="number">1000</span>,<span class="number">700</span>)</span><br></pre></td></tr></table></figure></p>
<p>鼠标拖曳，指从当前位置按下鼠标，移动至目标位置再释放的过程，指定目标位置同样有绝对位置和相对位置两种方式，和移动鼠标函数很像。另外，试用下来，未发现drag()函数和dragRel()的差异。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将鼠标从当前位置拖至屏幕中心，默认左键</span></span><br><span class="line">In [<span class="number">32</span>]: pyautogui.dragTo(sizex/<span class="number">2</span>,sizey/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将鼠标从当前位置向左100像素、向右200像素拖动，过渡时间0.5秒，指定右键</span></span><br><span class="line">In [<span class="number">33</span>]: pyautogui.dragRel(<span class="number">-100</span>,<span class="number">200</span>,duration=<span class="number">0.5</span>,button=<span class="string">'right'</span>)</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li><p>键盘控制<br>控制按键，也是一个<code>press()</code>函数基本把活包干，按键动作往细分解包含<code>keyDown()</code>和<code>keyUp()</code>两个过程；在此基础上封装，有<code>typewrite()</code>和<code>hotkey()</code>两个高阶一点的函数，分别用于输入字符串和按快捷键。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 键名用字符串表示，支持的所有键名，存在pyautogui.KEYBOARD_KEYS变量中，包括26个字母、数字、符号、F1~F20、方向等等所有按键</span></span><br><span class="line">In [<span class="number">4</span>]: pyautogui.press(<span class="string">'a'</span>) <span class="comment"># 按字母A键，字母支持大小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序向终端输入了字符a，若程序运行时输入法为中文状态，由于没有继续输入空格或回车，输入法仅列出候选字，并不会输入到终端</span></span><br><span class="line">In [<span class="number">5</span>]: a </span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入键名列表（按键p、按键y、空格），按键之间间隔0.1秒（默认0）</span></span><br><span class="line">In [<span class="number">6</span>]: pyautogui.press([<span class="string">'p'</span>,<span class="string">'y'</span>,<span class="string">'space'</span>], interval=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行前将输入法切换到中文状态，往终端直接输入了“培养”</span></span><br><span class="line">In [<span class="number">7</span>]: 培养</span><br><span class="line"></span><br><span class="line"><span class="comment"># typewrite方式一：传入字符串，不支持中文字符，因为函数无法知道输入法需要什么按键才能得到中文字符</span></span><br><span class="line">In [<span class="number">9</span>]: pyautogui.typewrite(<span class="string">'hello, PyAutoGUI!\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序把字符串"'hello, PyAutoGUI!"和换行符输入到了终端</span></span><br><span class="line">In [<span class="number">10</span>]: hello, PyAutoGUI!</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line"><span class="comment"># typewrite方式二：传入键名列表，按键之间间隔0.1秒（默认0）</span></span><br><span class="line">In [<span class="number">11</span>]: pyautogui.typewrite([<span class="string">'s'</span>,<span class="string">'r'</span>,<span class="string">'f'</span>,<span class="string">'space'</span>], interval=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行前将输入法切换到中文状态，往终端直接输入了“输入法”3个字</span></span><br><span class="line">In [<span class="number">12</span>]: 输入法</span><br><span class="line"></span><br><span class="line"><span class="comment"># 大小写字母是自动支持的，仍然尝试一次切换到大写</span></span><br><span class="line">In [<span class="number">13</span>]: pyautogui.typewrite([<span class="string">'capslock'</span>,<span class="string">'p'</span>,<span class="string">'y'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># CapsLock按键灯被点亮，程序往终端输入了"PY"</span></span><br><span class="line">In [<span class="number">14</span>]: PY</span><br><span class="line"></span><br><span class="line"><span class="comment"># hotkey屏蔽了需要反复keyDown、keyUp的细节，参数是任意个键名，而非列表</span></span><br><span class="line">In [<span class="number">18</span>]: pyautogui.hotkey(<span class="string">'ctrl'</span>, <span class="string">'shift'</span>, <span class="string">'esc'</span>) <span class="comment">#调出任务管理器</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">19</span>]:pyautogui.hotkey(<span class="string">'alt'</span>,<span class="string">'ctrl'</span>,<span class="string">'delete'</span>) <span class="comment"># 并未调出重启界面</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>消息窗口<br><code>PyAutoGUI</code>利用<code>pymsgbox</code>的功能，以JavaScript风格函数提供消息框功能，包括<code>alert()</code>、<code>confirm()</code>、<code>prompt()</code>、<code>password()</code>，连参数都是一致的，熟悉JavaScript的朋友不会陌生。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">24</span>]: pyautogui.alert(text=<span class="string">'警告'</span>,title=<span class="string">'PyAutoGUI消息框'</span>,button=<span class="string">'OK'</span>)</span><br><span class="line">Out[<span class="number">24</span>]: <span class="string">'OK'</span> <span class="comment"># 点击的按键被返回</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">28</span>]: pyautogui.confirm(text=<span class="string">'请选择'</span>,title=<span class="string">'PyAutoGUI消息框'</span>,buttons=[<span class="string">'1'</span>,<span class="string">'2'</span></span><br><span class="line">    ...: ,<span class="string">'3'</span>])</span><br><span class="line">Out[<span class="number">28</span>]: <span class="string">'2'</span> <span class="comment"># 点击的按键被返回</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">30</span>]: pyautogui.prompt(text=<span class="string">'请输入'</span>,title=<span class="string">'PyAutoGUI消息框'</span>,default=<span class="string">'请输入'</span>)</span><br><span class="line">Out[<span class="number">30</span>]: <span class="string">'input by 伪码人'</span> <span class="comment"># 点OK按钮后返回输入内容</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">32</span>]: pyautogui.password(text=<span class="string">'输入密码'</span>,title=<span class="string">'PyAutoGUI消息框'</span>,default=<span class="string">''</span>,mask=<span class="string">'*'</span>)</span><br><span class="line">Out[<span class="number">32</span>]: <span class="string">'We_Coder'</span> <span class="comment"># 点OK按钮后返回输入内容</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="https://pic1.zhimg.com/80/v2-69dd7705018fbdfd2857c6ffbc53ace8_720w.jpg" alt="PyAutoGUI的4种消息框"></p>
<ol start="5">
<li>截图相关<br>PyAutoGUI提供了screenshot()函数进行屏幕截图，返回是Image对象，这是在Pillow库中定义的，因此需要安装Pillow库才能正常工作。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># imageFilename参数，截图要保存的文件全路径名，默认`None`，不保存；</span></span><br><span class="line"><span class="comment"># region参数，截图区域，由左上角坐标、宽度、高度4个值确定，如果指定区域超出了屏幕范围，超出部分会被黑色填充，默认`None`,截全屏</span></span><br><span class="line">In [<span class="number">41</span>]: pyautogui.screenshot(<span class="string">'shot.png'</span>,region=(<span class="number">1000</span>,<span class="number">600</span>,<span class="number">600</span>,<span class="number">400</span>))</span><br><span class="line">Out[<span class="number">41</span>]: &lt;PIL.Image.Image image mode=RGB size=<span class="number">600</span>x400 at <span class="number">0x20C87497390</span>&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="https://pic2.zhimg.com/80/v2-b6d1990b61b96c81284e9a2b32bc5c4d_720w.jpg" alt="PyAutoGUI截图600×400"></p>
<p><code>PyAutoGUI</code>还有个图片匹配功能，它是在屏幕按像素匹配，定位图片在屏幕上的坐标位置，<code>locateOnScreen()</code>函数返回<code>region</code>对象,即左上角坐标、宽度、高度4个值组成的元组，再用<code>center()</code>函数计算出中心坐标，<code>locateCenterOnScreen()</code>函数则一步到位，返回中心坐标。如果把需要点击的菜单、按钮事先保存成图片，可以用来自动查找菜单、按钮位置，再交由<code>click()</code>函数控制鼠标去点击。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loc = pyautogui.locateCenterOnScreen(<span class="string">"icon_xx.png"</span>, region=(<span class="number">0</span>, <span class="number">0</span>,sizex/<span class="number">2</span>, sizey/<span class="number">10</span>) ) <span class="comment"># region参数限制查找范围，加快查找速度</span></span><br><span class="line">pyautogui.moveTo(*loc, duration=<span class="number">0.5</span>) <span class="comment"># 移动鼠标</span></span><br><span class="line">pyautogui.click(clicks=<span class="number">1</span>) <span class="comment">#点击</span></span><br></pre></td></tr></table></figure></p>
<h1 id="0x02-任务示例"><a href="#0x02-任务示例" class="headerlink" title="0x02 任务示例"></a>0x02 任务示例</h1><p>前文只是<code>PyAutoGUI</code>相关函数的说明，要真正熟悉它，必须结合具体任务。现有这样一个任务，成千上万个CAD图分布在几十个文件夹中，需要对每个图进行编辑操作，假使这个操作就是简单旋转下视角，再保存。AutoCAD程序本身是有脚本功能的，因此可以利用AutoCAD来完成本任务，综合考虑以下原因促使我转向PyAutoGUI的路线上来：</p>
<ol>
<li>AutoCAD是商业软件，本人希望尽可能地减少对商业软件的依赖；</li>
<li>AutoCAD的脚本功能十分有限，没有循环，难以适应如此多数量的文件操作，而且去熟悉AutoCAD脚本可能比PyAutoGUI更花时间；</li>
<li>利用PyAutoGUI熟悉GUI控制后，可以套在别的GUI程序上，未来仍有使用价值，如果使用AutoCAD则始终被限定在AutoCAD的操作范围内，价值低，而且与第一条相悖。</li>
</ol>
<p>决定走PyAutoGUI的路线，做了如下工作：</p>
<ol>
<li>找到另一个轻量看图软件，支持简单的编辑功能，正好包括旋转视角；</li>
<li>手工操作键盘鼠标，利用这个看图软件完成1个文件的编辑、保存流程；</li>
<li>将涉及操作的菜单、按钮等截图保存起来备用，将上述流程代码化，落地成果就是1个操作函数；</li>
<li>由于看图软件应需要时间，移动、点击鼠标等操作的过渡时间需要调试确定；</li>
<li>完成1个文件的操作流程后，在主函数编写文件匹配、循环等功能，在循环中调用操作函数，初期只拿10个文件批量操作，调试无误后，主函数的文件匹配修改为整个文件夹，包含成千上万个文件。</li>
</ol>
<p>操作函数代码。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pyautogui <span class="keyword">as</span> pag</span><br><span class="line"></span><br><span class="line">__sizex__, __sizey__ = pag.size() <span class="comment">#获得屏幕尺寸</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cad_turn</span><span class="params">(cad_file, outd)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    cad_file  :  要操作的CAD文件</span></span><br><span class="line"><span class="string">    outd      :  文件输出路径</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    c = pag.locateCenterOnScreen(__icon_open__, region=(<span class="number">0</span>,<span class="number">0</span>,__sizex__/<span class="number">10</span>,__sizey__/<span class="number">20</span>) ) <span class="comment"># 打开图标，图标事先截图保存</span></span><br><span class="line">    pag.moveTo(*c, duration=<span class="number">0.05</span>)</span><br><span class="line">    pag.click( button=<span class="string">"left"</span>) <span class="comment"># 点击打开按钮</span></span><br><span class="line"></span><br><span class="line">    pag.moveRel(__sizex__/<span class="number">4</span>, __sizey__/<span class="number">4</span>) <span class="comment"># 确保文件打开窗口获得焦点    </span></span><br><span class="line">    pag.typewrite(message=cad_file,interval=<span class="number">0.1</span>) <span class="comment"># 输入文件路径</span></span><br><span class="line">    pag.press(<span class="string">'enter'</span>)</span><br><span class="line"></span><br><span class="line">    c = pag.locateCenterOnScreen(__icon_view__, region=(__sizex__/<span class="number">4</span>, <span class="number">0</span>,__sizex__/<span class="number">2</span>, __sizey__/<span class="number">10</span>) )  <span class="comment"># 旋转视图图标</span></span><br><span class="line">    pag.moveTo(*c, duration=<span class="number">2</span>)</span><br><span class="line">    pag.click(clicks=<span class="number">7</span>, interval=<span class="number">1</span>, button=<span class="string">"left"</span>) <span class="comment"># 点击旋转视角按钮</span></span><br><span class="line"></span><br><span class="line">    c = pag.locateCenterOnScreen(__icon_saveas__, region=(<span class="number">0</span>, <span class="number">0</span>, __sizex__/<span class="number">10</span>, __sizey__/<span class="number">20</span>) ) <span class="comment"># 另存为图标</span></span><br><span class="line">    pag.moveTo(*c, duration=<span class="number">0.2</span>)</span><br><span class="line">    pag.click( button=<span class="string">"left"</span>) <span class="comment"># 点击另存为按钮</span></span><br><span class="line"></span><br><span class="line">    pag.moveRel(__sizex__/<span class="number">4</span>, __sizey__/<span class="number">4</span>) <span class="comment"># 确保文件打开窗口获得焦点</span></span><br><span class="line">    pag.typewrite(message=os.path.join(out, fbase+<span class="string">'-se'</span>), interval=<span class="number">0.1</span>) <span class="comment"># 输入保存路径</span></span><br><span class="line">    pag.press(<span class="string">'enter'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭所有可能存在的窗口，避免占用太多内存</span></span><br><span class="line">    <span class="keyword">while</span>( <span class="literal">True</span> ): </span><br><span class="line">        <span class="keyword">try</span> :</span><br><span class="line">            pag.moveTo(__sizex__/<span class="number">2</span>, __sizey__/<span class="number">2</span>, duration=<span class="number">0.3</span>) <span class="comment"># 延时</span></span><br><span class="line">            c = pag.locateCenterOnScreen(__icon_close__, region=(__sizex__/<span class="number">5</span>, <span class="number">0</span>, __sizex__*<span class="number">3</span>/<span class="number">5</span>, __sizey__/<span class="number">20</span>) )</span><br><span class="line">            pag.moveTo(*c, duration=<span class="number">0.1</span>) <span class="comment"># 移到“x”按钮</span></span><br><span class="line">            pag.click( button=<span class="string">"left"</span>) <span class="comment"># 点击“x”按钮</span></span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p>
<p>主函数代码。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    p = <span class="string">r'x/y/z/CAD文件所在路径'</span></span><br><span class="line">    cad_src = glob_file_list( p, <span class="string">r"*.DXF"</span>) <span class="comment"># 匹配出要操作的文件</span></span><br><span class="line">    total = len(cad_src)</span><br><span class="line">    <span class="keyword">if</span>(total == <span class="number">0</span>):</span><br><span class="line">        print(<span class="string">'无文件需处理，退出...'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> idx,x <span class="keyword">in</span> enumerate(cad_src, start=<span class="number">1</span>):</span><br><span class="line">            print(<span class="string">"[&#123;&#125;/&#123;&#125;] 处理&#123;&#125;..."</span>.format(idx, total, x))</span><br><span class="line">            cad_turn(x, <span class="string">"out"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"错误:&#123;&#125;"</span>.format(e))</span><br></pre></td></tr></table></figure></p>
<p>开启看图软件，输入法切换到英文状态，再运行Python程序，效果见<a href="https://www.zhihu.com/zvideo/1313113646529048576" target="_blank" rel="noopener">视频</a>。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://github.com/asweigart/pyautogui" target="_blank" rel="noopener">https://github.com/asweigart/pyautogui</a></li>
<li><a href="https://github.com/mhammond/pywin32" target="_blank" rel="noopener">https://github.com/mhammond/pywin32</a></li>
<li><a href="https://github.com/pywinauto/pywinauto" target="_blank" rel="noopener">https://github.com/pywinauto/pywinauto</a></li>
<li><a href="https://github.com/vinta/awesome-python" target="_blank" rel="noopener">https://github.com/vinta/awesome-python</a></li>
<li><a href="https://github.com/jobbole/awesome-python-cn" target="_blank" rel="noopener">https://github.com/jobbole/awesome-python-cn</a></li>
</ul>
<h1 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h1><ul>
<li><a href="/2019/2019-08-15-Python项目如何合理组织规避import天坑.html">Python项目如何合理组织规避import天坑</a></li>
<li><a href="/2019/2019-06-16-Cygwin系列（九）：Cygwin学习路线.html">Cygwin系列（九）：Cygwin学习路线</a></li>
<li><a href="/2019/2019-04-04-Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念.html">Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念</a> </li>
<li><a href="/2019/2019-05-04-Linux Cygwin知识库（二）：目录、文件及基本操作.html">Linux Cygwin知识库（二）：目录、文件及基本操作</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/102460964" target="_blank" rel="noopener">知乎：伪码人专栏目录导航</a></li>
</ul>
<hr>
<p><strong>如本文对你有帮助，或内容引起极度舒适，欢迎分享转发或点击下方捐赠按钮打赏</strong> ^_^</p>
</div><iframe src="/donate/?AliPayQR=/pic/AliPayQR.jpg&amp;WeChatQR=/pic/WeChatQR.png&amp;GitHub=https://github.com/Kaiyuan/donate-page&amp;BTCQR=undefined&amp;BTCKEY=undefined&amp;PayPal=undefined" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>silaoA</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2020/2020-11-27-Python自动操作GUI神器PyAutoGUI.html">https://silaoa.github.io/2020/2020-11-27-Python自动操作GUI神器PyAutoGUI.html</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为原创文章，如需转载，请联系stsilaoa@gmail.com 或 公众号 伪码人 或知乎私信 silaoA。</li></ul></div><br><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a class="pre" href="/2021/2021-06-02-WSLg：为WSL增光添彩.html">WSLg：为WSL增光添彩</a><a class="next" href="/2020/2020-04-25-Cygwin系列（十二）：了解X.html">Cygwin系列（十二）：了解X</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://silaoa.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">31</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/Cygwin/" style="font-size: 15px;">Cygwin</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/IEEE/" style="font-size: 15px;">IEEE</a> <a href="/tags/机器人/" style="font-size: 15px;">机器人</a> <a href="/tags/科技/" style="font-size: 15px;">科技</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/WSL/" style="font-size: 15px;">WSL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/2022-12-31-Python打印彩色字符.html">Python打印彩色字符</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/2022-04-23-Linux Cygwin知识库：图形技术栈.html">Linux Cygwin知识库：图形技术栈</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/2021-10-30-Cygwin系列（十三）：折腾X.html">Cygwin系列（十三）：折腾X</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/2021-06-02-WSLg：为WSL增光添彩.html">WSLg：为WSL增光添彩</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/2020-11-27-Python自动操作GUI神器PyAutoGUI.html">Python自动操作GUI神器PyAutoGUI</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/2020-04-25-Cygwin系列（十二）：了解X.html">Cygwin系列（十二）：了解X</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/2020-01-13-Cygwin系列（十一）：折腾终端2.html">Cygwin系列（十一）：折腾终端2</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-29-Cygwin系列（十）：折腾终端1.html">Cygwin系列（十）：折腾终端1</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-20-Python操作Excel文件（3）：优雅干将openpyxl.html">Python操作Excel文件（3）：优雅干将openpyxl</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/2019-12-16-Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils.html">Python操作Excel文件（2）：中规中矩三兄弟xlrd、xlwt和xlutils</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://silaoa.github.io" title="silaoA的博客" target="_blank">silaoA的博客</a><ul></ul><a href="https://zhuanlan.zhihu.com/p/102460964" title="silaoA的知乎文章导航" target="_blank">silaoA的知乎文章导航</a><ul></ul><a title="微信公众号：伪码人（We_Coder）" target="_blank">微信公众号：伪码人（We_Coder）</a><ul></ul><a title="QQ交流群：374791536" target="_blank">QQ交流群：374791536</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">silaoA的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>